<app-loading-spinner *ngIf="isLoading"/>

<div>
    <div class="flex justify-end items-right mb-8">

        <div class="flex items-center">
            <i class="mr-6 w-6 h-6 fill-current text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <path
                        d="M0 416c0 17.7 14.3 32 32 32l54.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 448c17.7 0 32-14.3 32-32s-14.3-32-32-32l-246.7 0c-12.3-28.3-40.5-48-73.3-48s-61 19.7-73.3 48L32 384c-17.7 0-32 14.3-32 32zm128 0a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM320 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm32-80c-32.8 0-61 19.7-73.3 48L32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l246.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48l54.7 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-54.7 0c-12.3-28.3-40.5-48-73.3-48zM192 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm73.3-64C253 35.7 224.8 16 192 16s-61 19.7-73.3 48L32 64C14.3 64 0 78.3 0 96s14.3 32 32 32l86.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 128c17.7 0 32-14.3 32-32s-14.3-32-32-32L265.3 64z" />
                </svg>
            </i>




            <div class="mx-6">
                <p-dropdown
                    styleClass="border border-2 rounded-xl items-center bg-[#F1F1F1] dark:bg-[#272F45] text-textLight dark:text-textDark border-[#yourLightColor] dark:border-[#AFAFAF] h-10"
                    [options]="status" [(ngModel)]="selectedStatus" [showClear]="!!selectedStatus" placeholder="Status"
                    (onChange)="applyStatus()" />
            </div>

            <div class="flex items-center gap-2 h-8">
                

                      <div>
            <p-calendar
              id="deliveryDate"
              [(ngModel)]="dateFilter"
              (onSelect)="onFilterChange()"
              (onClear)="onDateFilterClear()"
              placeholder="Delivery Date"
              [showIcon]="true"
              [showClear]="true"
              [showButtonBar]="true"
              dateFormat="yy-mm-dd"
              [monthNavigator]="true"
              [yearNavigator]="true"
              yearRange="1900:2030"
              iconDisplay="input"
              [style]="{ width: '16rem', height: '2rem' }"
              panelStyleClass="calendar-popup-small rounded-xl dark:bg-[#2d354d] dark:text-textDark dark:border-gray-600 
                   [&_.p-datepicker-calendar_td_span:hover]:dark:bg-[#4a5568] 
                   [&_.p-datepicker-calendar_td_span:hover]:dark:text-white
                   [&_.p-datepicker-header]:dark:bg-[#2d354d] 
                   [&_.p-datepicker-header]:dark:text-white
                   [&_.p-datepicker-buttonbar]:dark:bg-[#2d354d]
                   [&_.p-button:hover]:dark:bg-[#6b7280]"
              inputStyleClass="p-2 border cursor-pointer rounded-xl bg-[#F1F1F1] dark:bg-[#272F45] text-textLight dark:text-textDark w-64 h-8 pr-12"
              [appendTo]="'body'"
            />
          </div>

         
            </div>

              
            <div class="w-5"></div>
            <div class="flex items-center rounded-full bg-gray-100 dark:bg-[#272F45] px-4 py-2 w-96"
                title="Search by crop & variety">
                <input type="text" placeholder="Search by Invoice No..." class="bg-transparent outline-none w-full text-gray-600"
                    [(ngModel)]="search" (keydown.enter)="applySearch()" />
                <button type="button" class="text-gray-500 hover:text-gray-700 focus:outline-none mr-2"
                    (click)="applySearch()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 10-14 0 7 7 0 0014 0z" />
                    </svg>
                </button>
                <button (click)="clearSearch()" type="button"
                    class="text-gray-500 hover:text-gray-700 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div class="flex justify-between items-center mb-5">
        <h4 class="text-2xl font-normal text-[#292929] dark:text-textDark">
            All ({{totalItems | number: '2.0'}})
        </h4>
    </div>

    <div>
        <div *ngIf="!hasData" class="flex flex-col items-center w-full h-screen mt-6">
            <p class="text-[#494949] my-6 dark:text-white">--No Data Available--</p>
            <img src="assets/images/NoData.png" alt="No Data" class="w-20 h-20" />
        </div>

        <table *ngIf="hasData" class="min-w-full divide-y divide-gray-200 table-auto">
            <thead>
                <tr>
                    <th class="py-3 font-normal text-[#4B5563] dark:text-textDark text-left">
                        No
                    </th>
                    <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-start">
                        Invoice No
                    </th>
                    <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-start">
                        Package Name
                    </th>
                    <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                        Package Items
                    </th>
                    <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                        Package Price (Rs.)
                    </th>
                    <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center ">
                        Additional Items
                    </th>
                    <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                        Additional Items Price (Rs.)
                    </th>
                    <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                        Scheduled Dilevery Date
                    </th>
                    <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                        Total Price (Rs.)
                    </th>
                    <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                        Packaging Status
                    </th>
                     <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
Completed By                    </th>


                </tr>
            </thead>
            <tbody>
                <tr *ngFor="
              let item of premadePackages
                | paginate
                  : {
                      itemsPerPage: itemsPerPage,
                      currentPage: page,
                      totalItems: totalItems
                    }
                    let i = index
            ">
                    <td class="py-3 text-[#000000] dark:text-textDark text-left">
                        {{ ((page - 1) * itemsPerPage + i + 1) | number: '2.0' }}
                    </td>

                    <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-start">
                        {{ item.invNo }}
                    </td>
                    <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-start">
                        {{ item.displayName }}
                    </td>

                    <td class="px-4 py-3 font-normal text-gray-500 dark:text-textDark text-center">
                        <!-- (click)="navigateToPackageItemView(item.processOrderId, item.invNo, item.packageProductsCount, item.displayName, item.fullTotal)" -->

                        <button class="w-6 h-6 mr-3" 
                        [disabled]="item.packageStatus === 'Unknown'"
                        (click)="navigateToPackageItemView(item.processOrderId, item.invNo, item.totcount, item.displayName, item.productPrice)"
                        [ngClass]="{
                            'text-gray-100 cursor-not-allowed': item.packageStatus === 'Unknown',
                          'text-yellow-500 hover:text-yellow-700': item.packageStatus === 'Opened',
                          'text-green-500 hover:text-green-700': item.packageStatus === 'Completed',
                          'text-red-500 hover:text-red-700': item.packageStatus === 'Pending'
                        }">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M3 14C3 9.02944 7.02944 5 12 5C16.9706 5 21 9.02944 21 14M17 14C17 16.7614 14.7614 19 12 19C9.23858 19 7 16.7614 7 14C7 11.2386 9.23858 9 12 9C14.7614 9 17 11.2386 17 14Z"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </button>

                    </td>

                    <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                        {{ item.productPrice | number: '1.2-2' }}
                    </td>
                    <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                        <!-- (click)="navigateToAdditionalItemView(item.processOrderId, item.invNo, item.additionalProductsCount, item.displayName, item.totalAdditionalItemsPrice)" -->

                        <button
                            (click)="navigateToAdditionalItemView(item.processOrderId, item.invNo, item.orderAdditionalCount, item.displayName, item.additionalPrice)"
                            class="w-6 h-6 mr-3" [disabled]="item.additionalItemsStatus === 'Unknown'" [ngClass]="{
                              'text-gray-300 cursor-not-allowed': item.additionalItemsStatus === 'Unknown',
                              'text-yellow-500 hover:text-yellow-700': item.additionalItemsStatus === 'Opened' && item.orderAdditionalCount > 0,
                              'text-green-500 hover:text-green-700': item.additionalItemsStatus === 'Completed' && item.orderAdditionalCount > 0,
                              'text-red-500 hover:text-red-700': item.additionalItemsStatus === 'Pending' && item.orderAdditionalCount > 0
                            }"
                            [disabled]="item.additionalItemsStatus === 'Unknown'">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M3 14C3 9.02944 7.02944 5 12 5C16.9706 5 21 9.02944 21 14M17 14C17 16.7614 14.7614 19 12 19C9.23858 19 7 16.7614 7 14C7 11.2386 9.23858 9 12 9C14.7614 9 17 11.2386 17 14Z"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </button>
                        
                    </td>

                    <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                        <ng-container *ngIf="item.additionalPrice !== '0'; else showDash">
                            {{ item.additionalPrice | number: '1.2-2' }}
                        </ng-container>
                        <ng-template #showDash>-</ng-template>
                    </td>
                    <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                        {{ item.sheduleDate | date: 'd MMM, y' }}
                    </td>
                    <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                        {{ calculateTotPrice(item.additionalPrice, item.productPrice) | number: '1.2-2' }}
                    </td>

                    <td class="px-4 py-3 text-center">
                        <ng-container *ngIf="item.packageStatus === 'Pending'">
                            <span
                                class="w-24 h-7 inline-block bg-[#FFB9B7] text-[#D16D6A] font-medium rounded-md px-3 py-1 text-sm">
                                Pending
                            </span>
                        </ng-container>

                        <ng-container *ngIf="item.packageStatus === 'Opened'">
                            <span
                                class="w-24 h-7 inline-block bg-[#F8FFA6] text-[#A8A100] font-medium rounded-md px-3 py-1 text-sm">
                                Opened
                            </span>
                        </ng-container>

                        <ng-container *ngIf="item.packageStatus === 'Completed'">
                            <span
                                class="w-24 h-7 inline-block bg-[#BBFFC6] text-[#308233] font-medium rounded-md px-3 py-1 text-sm">
                                Completed
                            </span>
                        </ng-container>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="dark:bg-[#262f45]">
            <pagination-controls (pageChange)="onPageChange($event)" [responsive]="true" [previousLabel]="'Previous'"
                [nextLabel]="'Next'" [screenReaderPaginationLabel]="'Pagination'" [screenReaderPageLabel]="'page'"
                [screenReaderCurrentLabel]="'Youre on page'">
            </pagination-controls>
        </div>
    </div>
</div>