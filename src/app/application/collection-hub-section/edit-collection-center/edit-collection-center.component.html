<app-loading-spinner *ngIf="isLoading"></app-loading-spinner>
<button (click)="back()" class="text-textLight dark:text-textDark">
  <i class="fa-solid fa-arrow-left"></i> Back
</button>

<div class="h-[20px]"></div>

<div class="mx-auto p-6 bg-white dark:bg-tileBlack rounded-lg shadow-mg">
  <h2 class="text-2xl mb-6 text-textLight dark:text-textDark">
    Update Collection Centre
  </h2>

  <form (ngSubmit)="onSubmit()">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <!-- Registration Code -->

      <!-- Collection Center Name -->
      <div>
        <label
          for="centerName"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
          >Collection Centre Name</label
        >
        <input
          id="centerName"
          name="centerName"
          [(ngModel)]="centerFetchData.centerName"
          #centerNameInput="ngModel"
          [value]="centerFetchData.centerName"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
        />
        <div
          *ngIf="centerNameInput.touched && !centerFetchData.centerName"
          class="text-red-500 text-sm mt-1"
        >
          <div>Centre Name is required</div>
        </div>
      </div>

      <div class="relative">
        <!-- Input Field -->
        <label
          for="companies"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
        >
          Company Name
        </label>
        <input
          type="text"
          id="companies"
          name="companies"
          [(ngModel)]="centerFetchData.companies"
          readonly
          class="mt-2 block w-full p-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-800 cursor-pointer"
          placeholder="Select companies"
          (click)="toggleDropdown()"
        />

        <!-- Dropdown -->
        <!-- Dropdown -->
        <div
          *ngIf="dropdownOpen"
          class="absolute left-0 w-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 rounded-md shadow-lg z-50 max-h-60 overflow-auto"
          style="top: 100%; position: absolute"
        >
          <div
            *ngFor="let company of CompanyData"
            class="p-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700"
            (click)="toggleSelection(company)"
          >
            <input
              type="checkbox"
              [checked]="selectedCompaniesIds.includes(company.id)"
              class="mr-2"
            />
            {{ company.companyNameEnglish }}
          </div>
        </div>
      </div>

      <div>
        <label
          for="contact01Code"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
        >
          Contact Number 01
        </label>

        <div class="mt-1 flex">
          <!-- Country Code Dropdown -->
          <select
            id="code1"
            [(ngModel)]="centerFetchData.code1"
            name="code1"
            class="block p-2 border border-gray-300 rounded-l-md bg-gray-50 mr-5 text-textLight dark:text-textDark dark:bg-tileBlack"
          >
            <option value="+94">+94 (LK)</option>
            <option value="+1">+1 (US)</option>
            <option value="+44">+44 (UK)</option>
            <option value="+91">+91 (India)</option>
          </select>
        
          <!-- Contact Number Input -->
          <div class="flex-1">
            <input
              type="text"
              [(ngModel)]="centerFetchData.contact01"
              id="contact01"
              name="contact01"
              #contact01="ngModel"
              required
              pattern="^[7][0-9]{8}$"
              class="block w-full p-2 border border-gray-300 rounded-r-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
              placeholder="Enter your phone number"
            />
          </div>
        </div>
        
        <!-- âœ… Validation Messages Below Full Row -->
        <div
          *ngIf="contact01.invalid && contact01.touched"
          class="text-red-500 text-sm mt-1"
        >
          <span *ngIf="contact01.errors?.['required']">
            Contact number-01 is required
          </span>
          <span *ngIf="contact01.errors?.['pattern']">
            Please enter a valid contact number
          </span>
        </div>
        
      </div>

      <!-- Contact Number 02 -->
      <div>
        <label
          for="contact02Code"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
        >
          Contact Number 02
        </label>
      
        <div class="mt-1 flex">
          <!-- Country Code Dropdown -->
          <select
            [(ngModel)]="centerFetchData.code2"
            id="code2"
            name="code2"
            class="block p-2 border border-gray-300 rounded-l-md bg-gray-50 mr-5 text-textLight dark:text-textDark dark:bg-tileBlack"
          >
            <option value="+94">+94 (LK)</option>
            <option value="+1">+1 (US)</option>
            <option value="+44">+44 (UK)</option>
            <option value="+91">+91 (India)</option>
          </select>
      
          <!-- Contact Input -->
          <input
            type="number"
            [(ngModel)]="centerFetchData.contact02"
            id="contact02"
            name="contact02"
            #contact02="ngModel"
            pattern="^[7][0-9]{8}$"
            class="flex-1 block p-2 border border-gray-300 rounded-r-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
            placeholder="Enter your phone number"
          />
        </div>
      
        <!-- Validation Message Below the Row -->
        <div
          *ngIf="contact02.invalid && contact02.touched && contact02.errors?.['pattern']"
          class="text-red-500 text-sm mt-1"
        >
          Please enter a valid contact number
        </div>
      </div>
      

      <!-- Building Number -->
      <div>
        <label
          for="buildingNumber"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
          >Building Number</label
        >
        <input
          type="text"
          id="buildingNumber"
          name="buildingNumber"
          [value]="centerFetchData.buildingNumber"
          [(ngModel)]="centerFetchData.buildingNumber"
          #buildingNumberInput="ngModel"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
        />
        <div
          *ngIf="buildingNumberInput.touched && !centerFetchData.buildingNumber"
          class="text-red-500 text-sm mt-1"
        >
          <div>Buliding number is required</div>
        </div>
      </div>

      <!-- Street Name -->
      <div>
        <label
          for="street"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
          >Street Name</label
        >
        <input
          id="street"
          name="street"
          [value]="centerFetchData.street"
          [(ngModel)]="centerFetchData.street"
          #streetInput="ngModel"
          pattern="^[a-zA-Z]*$"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
        />
        <div
          *ngIf="streetInput.touched && !centerFetchData.street"
          class="text-red-500 text-sm mt-1"
        >
          <div>Street is required</div>
        </div>
      </div>

      <div>
        <label
          for="city"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
          >City</label
        >
        <input
          type="text"
          id="city"
          name="city"
          [value]="centerFetchData.city"
          [(ngModel)]="centerFetchData.city"
          (input)="onCityChange()"
          (change)="onCityChange()"
          #cityInput="ngModel"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
        />
        <!-- ... validation ... -->
      </div>

      <!-- Province -->
      <div>
        <label
          for="province"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
          >Province</label
        >
        <select
          id="province"
          name="province"
          [(ngModel)]="selectProvince"
          (change)="onProvinceChange()"
          [value]="centerFetchData.province"
          #provinceInput="ngModel"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
        >
          <option selected disabled>-- select --</option>
          <option *ngFor="let item of ProvinceData" [value]="item.province">
            {{ item.province }}
          </option>
        </select>
        <!-- ... validation ... -->
      </div>

      <!-- District -->
      <div>
        <label
          for="district"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
          >District</label
        >
        <select
          id="district"
          name="district"
          [value]="centerFetchData.district"
          [(ngModel)]="centerFetchData.district"
          (change)="onDistrictChange()"
          #districtInput="ngModel"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
        >
          <option selected disabled>-- select --</option>
          <option
            *ngFor="let item of selectedDistrict"
            [value]="item.districtName"
          >
            {{ item.districtName }}
          </option>
        </select>
        <!-- ... validation ... -->
      </div>

      <div>
        <label
          for="country"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
          >Country</label
        >
        <select
          id="country"
          name="country"
          [(ngModel)]="centerFetchData.country"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
        >
          <option selected disabled>Sri Lanka</option>
        </select>
      </div>

      <!-- <div>
                <label for="regCode" class="block text-sm font-medium text-gray-700 dark:text-textDark">Reg Code</label>
                <input id="regCode" name="regCode"
                    [(ngModel)]="centerFetchData.regCode" #regCodeInput="ngModel"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
                    required />
                <div *ngIf="regCodeInput.touched && !centerFetchData.regCode" class="text-red-500 text-sm mt-1">
                    <div>RegCode is required</div>
                </div>
            </div> -->

      <div>
        <label
          for="regCode"
          class="block text-sm font-medium text-gray-700 dark:text-textDark"
          >Reg Code</label
        >
        <input
          id="regCode"
          name="regCode"
          [(ngModel)]="centerFetchData.regCode"
          #regCodeInput="ngModel"
          readonly
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
        />
        <!-- ... validation ... -->
      </div>
    </div>
    <div class="flex justify-end m-10">
      <div
        type="submit"
        class="px-6 py-2 mx-5 bg-[#74788D] text-white rounded-md"
        (click)="onCancel()"
      >
        Cancel
      </div>
      <button
        type="submit"
        class="px-6 py-2 bg-[#3980C0] text-white rounded-md"
        [disabled]="
          !centerFetchData.centerName ||
          !centerFetchData.buildingNumber ||
          !centerFetchData.city ||
          !centerFetchData.companies ||
          !centerFetchData.contact01 ||
          !centerFetchData.country ||
          !centerFetchData.district ||
          !centerFetchData.province ||
          !centerFetchData.street
        "
      >
        Save
      </button>
    </div>
  </form>
</div>
