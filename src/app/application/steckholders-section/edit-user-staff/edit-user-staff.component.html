<app-loading-spinner *ngIf="isLoading"></app-loading-spinner>

<button class="mb-5 text-textLight dark:text-textDark" (click)="back()">
    <i class="fa-solid fa-arrow-left"></i>
    Back
</button>

<div class="py-6 bg-tileLight dark:bg-tileBlack rounded-lg shadow-lg px-10 min-h-[500px]">
    <h2 class="text-2xl mb-6 text-textLight dark:text-textDark">
        Edit GoViCare Farm Staff
    </h2>

    <form [formGroup]="userForm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-11 mb-4 ml-8 mr-8">
            <!-- First Name -->
            <div>
                <label for="firstName" class="block text-sm font-medium text-textLight dark:text-textDark">First Name *</label>
                <input id="firstName" formControlName="firstName"
                       class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-tileLight dark:bg-tileBlack text-textLight dark:text-textDark" />
                <span class="text-red-600 text-sm" *ngIf="userForm.get('firstName')?.invalid && (userForm.get('firstName')?.dirty || userForm.get('firstName')?.touched)">
                    First Name is required.
                </span>
            </div>

            <!-- Last Name -->
            <div>
                <label for="lastName" class="block text-sm font-medium text-textLight dark:text-textDark">Last Name *</label>
                <input id="lastName" formControlName="lastName"
                       class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-tileLight dark:bg-tileBlack text-textLight dark:text-textDark" />
                <span class="text-red-600 text-sm" *ngIf="userForm.get('lastName')?.invalid && (userForm.get('lastName')?.dirty || userForm.get('lastName')?.touched)">
                    Last Name is required.
                </span>
            </div>
<div>
  <label class="block text-sm font-medium text-textLight dark:text-textDark">Phone Number *</label>
  <div class="flex gap-2 mt-1">
    <select formControlName="phoneCode"
            class="w-20 p-2 border border-gray-300 rounded-md bg-tileLight dark:bg-tileBlack text-textLight dark:text-textDark">
      <option value="" disabled>Select</option>
      <option *ngFor="let code of phoneCodes" [value]="code">{{ code }}</option>
    </select>
    <input type="tel" formControlName="phoneNumber" id="phoneNumber"
           pattern="^[0-9]{9}$" minlength="9" maxlength="9"
           (keypress)="allowOnlyNumbers($event)" (ngModelChange)="validateSriLankanPhone($event)"
           class="flex-1 p-2 border border-gray-300 rounded-md bg-tileLight dark:bg-tileBlack text-textLight dark:text-textDark"
           placeholder="Enter phone number" />
  </div>
  <div *ngIf="userForm.get('phoneCode')?.touched || userForm.get('phoneNumber')?.touched">
    <div *ngIf="userForm.get('phoneCode')?.hasError('required') || userForm.get('phoneNumber')?.hasError('required')"
         class="text-red-600 text-sm mt-1">
      Phone Code and Number are required.
    </div>

    <div *ngIf="isPhoneInvalid && userForm.get('phoneNumber')?.value"
         class="text-red-600 text-sm mt-1">
      Please enter a valid Phone Number (format: +947XXXXXXXX).
    </div>
  </div>
</div>

<!-- NIC -->
<div>
  <label for="nic" class="block text-sm font-medium text-textLight dark:text-textDark">NIC Number *</label>
  <input id="nic" formControlName="nic"
         class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-tileLight dark:bg-tileBlack text-textLight dark:text-textDark" />
  <div *ngIf="userForm.get('nic')?.touched && userForm.get('nic')?.invalid"
       class="text-red-600 text-sm mt-1">
    Please enter a valid NIC number (12 digits or 9 digits followed by 'V')
  </div>
</div>

            <!-- Role -->
            <div>
                <label for="role" class="block text-sm font-medium text-textLight dark:text-textDark">Role *</label>
                <select id="role" formControlName="role"
                        class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-tileLight dark:bg-tileBlack text-textLight dark:text-textDark">
                    <option value="" disabled>Select Role</option>
                    <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
                </select>
                <span class="text-red-600 text-sm" *ngIf="userForm.get('role')?.invalid && (userForm.get('role')?.dirty || userForm.get('role')?.touched)">
                    Role is required.
                </span>
            </div>
        </div>

        <div class="flex space-x-2 justify-end mb-4 ml-8 mr-8">
            <button type="button" class="px-4 py-2 mt-5 bg-[#74788D] text-white rounded" (click)="back()">Cancel</button>
            <button type="submit" class="px-6 py-2 mt-5 bg-[#3980C0] text-white rounded" (click)="save()">Save</button>
        </div>
    </form>
</div>