<app-loading-spinner *ngIf="isLoading"></app-loading-spinner>

<div *ngIf="this.itemId == null">
  <button (click)="back()" class=" text-textLight dark:text-textDark">
    <i class="fa-solid fa-arrow-left"></i>
    Back
  </button>
  <div class="h-[20px]"></div>

  <div class="mx-auto p-6 bg-tileLight dark:bg-tileBlack rounded-lg shadow-lg">
    <h2 class="text-xl font-semibold text-center mb-4 dark:text-textDark">
      ADD CROP VARIETY
    </h2>

    <div class="space-y-4">
      <!-- Crop Name -->
      <form [formGroup]="cropForm" (ngSubmit)="onSubmit()">
        <div>
          <label for="groupId" class="block text-sm font-medium text-textLight dark:text-textDark">Crop Name *</label>
          <select id="groupId" formControlName="groupId"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-tileLight dark:bg-tileBlack text-textLight dark:text-textDark">
            <option value="">Select a crop</option>
            <option *ngFor="let group of groupList" [value]="group.id">
              {{ group.cropNameEnglish }}
            </option>
          </select>
          <div *ngIf="
              cropForm.get('groupId')!.invalid &&
              (cropForm.get('groupId')!.dirty ||
                cropForm.get('groupId')!.touched)
            " class="text-red-500 text-sm mt-1">
            <div *ngIf="cropForm.get('groupId')!.errors?.['required']">
              Crop name is required
            </div>
          </div>
        </div>

        <hr class="border-[2px] border-gray-400 my-10" />

        <div>
          <label for="varietyNameEnglish" class="block text-sm font-medium text-gray-700 dark:text-textDark">Variety
            Name By English *</label>
          <input type="text" id="varietyNameEnglish" formControlName="varietyNameEnglish"
            (input)="onVarietyNameInput($event, 'english')"
            (keypress)="preventInvalidEnglishAlphanumericCharacters($event)" (paste)="validateEnglishPaste($event)"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-blue-500 dark:bg-tileBlack dark:text-textDark"
            required />
          <div *ngIf="
      cropForm.get('varietyNameEnglish')!.invalid &&
      (cropForm.get('varietyNameEnglish')!.dirty ||
        cropForm.get('varietyNameEnglish')!.touched)
    " class="text-red-500 text-sm mt-1">
            <div *ngIf="cropForm.get('varietyNameEnglish')!.errors?.['required']">
              English Variety name is required
            </div>
            <div *ngIf="cropForm.get('varietyNameEnglish')!.errors?.['pattern']">
              Variety name cannot be only numbers.
            </div>
          </div>
        </div>

        <div class="md:col-span-2 my-3">
          <label for="specialNotes" class="block text-sm font-medium text-textLight dark:text-textDark">Description (in
            English) *</label>
          <textarea id="descriptionEnglish" formControlName="descriptionEnglish"
            (input)="onDescriptionInput($event, 'english')"
            (keypress)="preventInvalidEnglishAlphanumericCharacters($event)" (paste)="validateEnglishPaste($event)"
            name="descriptionEnglish" rows="3"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"></textarea>
          <div *ngIf="
      cropForm.get('descriptionEnglish')!.invalid &&
      (cropForm.get('descriptionEnglish')!.dirty ||
        cropForm.get('descriptionEnglish')!.touched)
    " class="text-red-500 text-sm mt-1">
            <div *ngIf="cropForm.get('descriptionEnglish')!.errors?.['required']">
              English Description is required
            </div>
          </div>
        </div>

        <hr class="border-[2px] border-gray-400 my-10" />

        <div>
          <label for="varietyNameSinhala" class="block text-sm font-medium text-gray-700 dark:text-textDark">Variety
            Name By Sinhala *</label>
          <input type="text" id="varietyNameSinhala" formControlName="varietyNameSinhala"
            (input)="onVarietyNameInput($event, 'sinhala')"
            (keypress)="preventInvalidSinhalaAlphanumericCharacters($event)" (paste)="validateSinhalaPaste($event)"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-blue-500 dark:bg-tileBlack dark:text-textDark"
            required />
          <div *ngIf="
      cropForm.get('varietyNameSinhala')!.invalid &&
      (cropForm.get('varietyNameSinhala')!.dirty ||
        cropForm.get('varietyNameEnglish')!.touched)
    " class="text-red-500 text-sm mt-1">
            <div *ngIf="cropForm.get('varietyNameSinhala')!.errors?.['required']">
              Sinhala Variety name is required
            </div>
            <div *ngIf="cropForm.get('varietyNameSinhala')!.errors?.['pattern']">
              Variety Sinhala name cannot be only numbers.
            </div>
          </div>
        </div>

        <div class="md:col-span-2 my-3">
          <label for="descriptionSinhala"
            class="block text-sm font-medium text-textLight dark:text-textDark">Description (in Sinhala) *</label>
          <textarea id="descriptionSinhala" formControlName="descriptionSinhala"
            (input)="onDescriptionInput($event, 'sinhala')"
            (keypress)="preventInvalidSinhalaAlphanumericCharacters($event)" (paste)="validateSinhalaPaste($event)"
            name="descriptionSinhala" rows="3"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"></textarea>
          <div *ngIf="
      cropForm.get('descriptionSinhala')!.invalid &&
      (cropForm.get('descriptionSinhala')!.dirty ||
        cropForm.get('descriptionSinhala')!.touched)
    " class="text-red-500 text-sm mt-1">
            <div *ngIf="cropForm.get('descriptionSinhala')!.errors?.['required']">
              Sinhala Description is required
            </div>
          </div>
        </div>


        <hr class="border-[2px] border-gray-400 my-10" />

        <div>
          <label for="varietyNameTamil" class="block text-sm font-medium text-gray-700 dark:text-textDark">Variety Name
            By Tamil *</label>
          <input type="text" id="varietyNameTamil" formControlName="varietyNameTamil"
            (input)="onVarietyNameInput($event, 'tamil')" (paste)="validateTamilPaste($event)"
            (keypress)="preventInvalidTamilAlphanumericCharacters($event)"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-blue-500 dark:bg-tileBlack dark:text-textDark"
            required />
          <div *ngIf="
      cropForm.get('varietyNameTamil')!.invalid &&
      (cropForm.get('varietyNameTamil')!.dirty ||
        cropForm.get('varietyNameTamil')!.touched)
    " class="text-red-500 text-sm mt-1">
            <div *ngIf="cropForm.get('varietyNameTamil')!.errors?.['required']">
              Tamil Variety name is required
            </div>
            <div *ngIf="cropForm.get('varietyNameTamil')!.errors?.['pattern']">
              Tamil Variety name cannot be only numbers.
            </div>
          </div>
        </div>

        <div class="md:col-span-2 my-3">
          <label for="descriptionTamil" class="block text-sm font-medium text-textLight dark:text-textDark">Description
            (in Tamil) *</label>
          <textarea id="descriptionTamil" formControlName="descriptionTamil"
            (input)="onDescriptionInput($event, 'tamil')" (keypress)="preventInvalidTamilAlphanumericCharacters($event)"
            (paste)="validateTamilPaste($event)" name="descriptionTamil" rows="3"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"></textarea>
          <div *ngIf="
      cropForm.get('descriptionTamil')!.invalid &&
      (cropForm.get('descriptionTamil')!.dirty ||
        cropForm.get('descriptionTamil')!.touched)
    " class="text-red-500 text-sm mt-1">
            <div *ngIf="cropForm.get('descriptionTamil')!.errors?.['required']">
              Tamil Description is required
            </div>
          </div>
        </div>

        <hr class="border-[2px] border-gray-400 my-10" />

        <!-- Add Image -->
        <input type="file" id="imageUpload" accept="image/*" class="hidden" (change)="onFileSelected($event)" />

        <!-- Button -->
        <button class="flex items-center text-textLight dark:text-textDark" (click)="triggerFileInput($event)">
          Add Image *
          <span
            class="flex justify-center items-center w-6 h-6 ml-2 border border-[#4A90E2] rounded text-blue-500 font-bold">
            <i class="fa-solid fa-plus" style="color: #4a90e2"></i>
          </span>
        </button>

        <div *ngIf="selectedFileName" class="mt-2 text-textLight dark:text-textDark w-full block">
          {{ selectedFileName }}
          <div class="w-full h-72 py-5 mt-2 content-center flex justify-center border">
            <img [src]="selectedImage" alt="Crop Image" class="max-w-full w-auto object-contain" />
          </div>
        </div>

        <!-- Add Background Color -->
        <div class="flex items-center space-x-4">
          <label for="bgColor" class="block text-sm font-medium text-textLight dark:text-textDark pt-2">Color *</label>
          <ngx-colors ngx-colors-trigger formControlName="bgColor" (colorChange)="onColorChange($event)"
            style="display: inline-block; margin: 5px">
          </ngx-colors>
          <div *ngIf="
              cropForm.get('bgColor')!.invalid &&
              (cropForm.get('bgColor')!.dirty ||
                cropForm.get('bgColor')!.touched)
            " class="text-red-500 text-sm mt-1">
            <div *ngIf="cropForm.get('bgColor')!.errors?.['required']">
              Background color is required
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="flex justify-end space-x-4 mt-6">
          <button type="button" (click)="onCancel()"
            class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md">
            Cancel
          </button>
          <button type="submit" class="px-6 py-2 mx-4 bg-[#3980C0] text-white rounded-md">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div *ngIf="this.itemId != null">
  <button (click)="backEdit()" class=" text-textLight dark:text-textDark">
    <i class="fa-solid fa-arrow-left"></i>
    Back
  </button>
  <div class="h-[20px]"></div>

  <div class="mx-auto p-6 bg-tileLight dark:bg-tileBlack rounded-lg shadow-lg ">
    <h2 class="text-xl font-semibold text-center mb-4 dark:text-textDark">EDIT CROP VARIETY</h2>

    <div class="space-y-4">
      <!-- Crop Name -->

      <!-- <div>

        <label for="groupId" class="block text-sm font-medium text-textLight dark:text-textDark">Crop Name</label>
        <select id="groupId" formControlName="groupId"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-tileLight dark:bg-tileBlack text-textLight dark:text-textDark"
          [(ngModel)]="cropVarity.cropGroupId"
          >
          <option value="">Select a crop</option>
          <option *ngFor="let group of groupList" [value]="group.id">
            {{ group.cropNameEnglish }}
          </option>
        </select>
      </div> -->

      <!-- <hr class="border-[2px] border-gray-400 my-10" /> -->

      <div>
        <label for="varietyNameEnglish" class="block text-sm font-medium text-gray-700 dark:text-textDark">Variety Name
          By English *</label>
        <input type="text" id="varietyNameEnglish" [(ngModel)]="newsItems[0].varietyNameEnglish"
  (input)="onEditVarietyNameInput($event, 'english')"
  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-blue-500 dark:bg-tileBlack dark:text-textDark"
  #verityEngNameInput="ngModel" pattern="^(?!\d+$)[\s\S]*" required />
        <div *ngIf="verityEngNameInput.touched && !newsItems[0].varietyNameEnglish" class="text-red-500 text-sm mt-1">
          <div>English Variety name is required</div>
        </div>

        <!-- Error: Pattern Validation -->
        <div *ngIf="verityEngNameInput.touched && verityEngNameInput.errors?.['pattern']"
          class="text-red-500 text-sm mt-1">
          <div>
            Variety English name cannot be only numbers.
          </div>
        </div>
      </div>

      <div class="md:col-span-2 my-3">
        <label for="specialNotes" class="block text-sm font-medium text-textLight dark:text-textDark">Description (in
          English) *</label>
        <textarea id="descriptionEnglish" name="descriptionEnglish" rows="3"
  [(ngModel)]="newsItems[0].descriptionEnglish"
  (input)="onEditDescriptionInput($event, 'english')"
  class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
  #verityDisEngNameInput="ngModel" required></textarea>
        <div *ngIf="
            verityDisEngNameInput.touched && !newsItems[0].descriptionEnglish
          " class="text-red-500 text-sm mt-1">
          <div>English Variety Discription is required</div>
        </div>
      </div>

      <hr class="border-[2px] border-gray-400 my-10" />

      <div>
        <label for="varietyNameSinhala" class="block text-sm font-medium text-gray-700 dark:text-textDark">Variety Name
          By Sinhala *</label>
        <input type="text" id="varietyNameSinhala" [(ngModel)]="newsItems[0].varietyNameSinhala"
  (input)="onEditVarietyNameInput($event, 'sinhala')"
  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-blue-500 dark:bg-tileBlack dark:text-textDark"
  #verietySinNameInput="ngModel" pattern="^(?!\d+$)[\s\S]*" required />
        <div *ngIf="
            verietySinNameInput.touched && !newsItems[0].varietyNameSinhala
          " class="text-red-500 text-sm mt-1">
          <div>Sinhala Variety name is required</div>
        </div>

        <!-- Error: Pattern Validation -->
        <div *ngIf="verietySinNameInput.touched && verietySinNameInput.errors?.['pattern']"
          class="text-red-500 text-sm mt-1">
          <div>
            Variety Sinhala name cannot be only numbers.
          </div>
        </div>
      </div>

      <div class="md:col-span-2 my-3">
        <label for="descriptionSinhala" class="block text-sm font-medium text-textLight dark:text-textDark">Description
          (in Sinhala) *</label>
        <textarea id="descriptionSinhala" name="descriptionSinhala" rows="3"
  [(ngModel)]="newsItems[0].descriptionSinhala"
  (input)="onEditDescriptionInput($event, 'sinhala')"
  class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
  #verietyDisSinNameInput="ngModel" required></textarea>
        <div *ngIf="
            verietyDisSinNameInput.touched && !newsItems[0].descriptionSinhala
          " class="text-red-500 text-sm mt-1">
          <div>Sinhala Variety Discrtiption is required</div>
        </div>
      </div>

      <hr class="border-[2px] border-gray-400 my-10" />

      <div>
        <label for="varietyNameTamil" class="block text-sm font-medium text-gray-700 dark:text-textDark">Variety Name By
          Tamil *</label>
        <input type="varietyNameTamil" id="varietyNameTamil" [(ngModel)]="newsItems[0].varietyNameTamil"
  (input)="onEditVarietyNameInput($event, 'tamil')"
  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-blue-500 dark:bg-tileBlack dark:text-textDark"
  #cropTamilNameInput="ngModel" pattern="^(?!\d+$)[\s\S]*" required />
        <div *ngIf="cropTamilNameInput.touched && !newsItems[0].varietyNameTamil" class="text-red-500 text-sm mt-1">
          <div>Tamil Variety name is required</div>
        </div>

        <!-- Error: Pattern Validation -->
        <div *ngIf="cropTamilNameInput.touched && cropTamilNameInput.errors?.['pattern']"
          class="text-red-500 text-sm mt-1">
          <div>
            Variety Tamil name cannot be only numbers.
          </div>
        </div>
      </div>
    </div>

    <div class="md:col-span-2 my-3">
      <label for="descriptionTamil" class="block text-sm font-medium text-textLight dark:text-textDark">Description (in
        Tamil) *</label>
      <textarea id="descriptionTamil" name="descriptionTamil" rows="3" [(ngModel)]="newsItems[0].descriptionTamil"
  (input)="onEditDescriptionInput($event, 'tamil')"
  class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
  #VerietyDisTamilInput="ngModel" required></textarea>
      <div *ngIf="VerietyDisTamilInput.touched && !newsItems[0].descriptionTamil" class="text-red-500 text-sm mt-1">
        <div>Tamil Variety Discription is required</div>
      </div>
    </div>

    <hr class="border-[2px] border-gray-400 my-10" />

    <!-- Add Image -->
    <input type="file" id="imageUpload" accept="image/*" class="hidden" (change)="onFileSelected($event)" />

    <!-- Button -->
    <button class="flex items-center text-textLight dark:text-textDark" (click)="triggerFileInput($event)">
      Add Image *
      <span
        class="flex justify-center items-center w-6 h-6 ml-2 border border-[#4A90E2] rounded text-blue-500 font-bold">
        <i class="fa-solid fa-plus" style="color: #4a90e2"></i>
      </span>
    </button>

    <div *ngIf="selectedFileName" class="mt-2 text-textLight dark:text-textDark w-full block">
      {{ selectedFileName }}
      <div class="w-full h-72 py-5 mt-2 content-center flex justify-center border">
        <img [src]="selectedImage" alt="Crop Image" class="max-w-full w-auto object-contain" />
      </div>
    </div>

    <!-- Add Background Color -->
    <div class="flex items-center space-x-4">
      <label for="bgColor" class="block text-sm font-medium text-textLight dark:text-textDark pt-2">Color *</label>
      <ngx-colors ngx-colors-trigger [(ngModel)]="newsItems[0].bgColor" (colorChange)="onColorChange($event)"
        style="display: inline-block; margin: 5px" #bgColorInput="ngModel">
      </ngx-colors>
      <div *ngIf="bgColorInput.touched && !newsItems[0].bgColor" class="text-red-500 text-sm mt-1">
        <div>Background color is required</div>
      </div>
    </div>

    <!-- Buttons -->
    <div class="flex justify-end space-x-4 mt-6">
      <button type="button" (click)="onCancel()"
        class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md">
        Cancel
      </button>
      <button type="submit" (click)="updateNews()" class="px-6 py-2 mx-4 bg-[#3980C0] text-white rounded-md">
        Save
      </button>
    </div>
  </div>
</div>