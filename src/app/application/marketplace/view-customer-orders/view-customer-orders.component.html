<app-loading-spinner *ngIf="isLoading"></app-loading-spinner>

<button class="mb-5 text-textLight dark:text-textDark" (click)="back()">
  <i class="fa-solid fa-arrow-left"></i>
  Back
</button>

<div
  class="fixed-width-container overflow-x-auto scrollbar-thin scrollbar-thumb-scrollBarColor scrollbar-track-transparent scrollbar-thumb-rounded-full">
  <div class="pt-5 pb-5 min-w-[1200px] bg-white dark:bg-tileBlack shadow-lg rounded-lg">
    <div class="flex space-x-4 pb-5 pr-12 pl-12 border-b border-gray-300 overflow-x-auto scrollbar-thin scrollbar-thumb-scrollBarColor scrollbar-track-transparent scrollbar-thumb-rounded-full">
      <button [ngClass]="
          activeButton === 'assigned'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('assigned')">
        <i *ngIf="activeButton === 'assigned'" class="fa fa-check"></i>
        Assigned
      </button>
      <button [ngClass]="
          activeButton === 'processing'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('processing')">
        <i *ngIf="activeButton === 'processing'" class="fa fa-check"></i>
        Processing
      </button>
      <button [ngClass]="
          activeButton === 'Out For Delivery'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('Out For Delivery')">
        <i *ngIf="activeButton === 'Out For Delivery'" class="fa fa-check"></i>
        Out for Delivery
      </button>
      <button [ngClass]="
          activeButton === 'Ready to Pickup'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('Ready to Pickup')">
        <i *ngIf="activeButton === 'Ready to Pickup'" class="fa fa-check"></i>
        Ready to Pickup
      </button>
      <button [ngClass]="
          activeButton === 'Picked up'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('Picked up')">
        <i *ngIf="activeButton === 'Picked up'" class="fa fa-check"></i>
        Picked up
      </button>
      <button [ngClass]="
          activeButton === 'collected'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('collected')">
        <i *ngIf="activeButton === 'collected'" class="fa fa-check"></i>
        Collected
      </button>
      <button [ngClass]="
          activeButton === 'On the way'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('On the way')">
        <i *ngIf="activeButton === 'On the way'" class="fa fa-check"></i>
        On the way
      </button>
      <button [ngClass]="
          activeButton === 'delivered'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('delivered')">
        <i *ngIf="activeButton === 'delivered'" class="fa fa-check"></i>
        Delivered
      </button>
      <button [ngClass]="
          activeButton === 'hold'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('hold')">
        <i *ngIf="activeButton === 'hold'" class="fa fa-check"></i>
        Hold
      </button>
      <button [ngClass]="
          activeButton === 'return'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('return')">
        <i *ngIf="activeButton === 'return'" class="fa fa-check"></i>
        Return
      </button>
      <button [ngClass]="
          activeButton === 'returnReceived'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('returnReceived')">
        <i *ngIf="activeButton === 'returnReceived'" class="fa fa-check"></i>
        Return Received
      </button>
      <button [ngClass]="
          activeButton === 'cancelled'
            ? 'border border-[#415CFF] text-[#415CFF]'
            : 'border border-gray-300 text-textLight dark:text-textDark'
        " class="h-10 px-5 flex items-center justify-center rounded-full gap-2 whitespace-nowrap"
        (click)="onStatusChange('cancelled')">
        <i *ngIf="activeButton === 'cancelled'" class="fa fa-check"></i>
        Cancelled
      </button>
    </div>

    <div class="h-5"></div>

    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="flex justify-center p-8">
      <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#415CFF]"></div>
    </div>
    <div *ngIf="!hasData" class="flex flex-col items-center w-full h-screen px-10 py-7 mt-6 ">
      <p class="text-[#494949] my-6 dark:text-textDark">--No Data Available--</p>
      <img src="assets/images/NoData.png" alt="No Data" class="w-20 h-20" />
    </div>

    <div *ngIf="hasData" class="px-5">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-[#4B555A] table-auto">
        <thead>
          <tr>
            <th class="px-3 py-3 font-normal text-textLight dark:text-textDark text-left">
              Invoice No
            </th>
            <th class="px-3 py-3 font-normal text-textLight dark:text-textDark text-center whitespace-nowrap">
              Order Time
            </th>
            <th class="px-3 py-3 font-normal text-textLight dark:text-textDark text-left whitespace-nowrap">
              Schedule
            </th>
            <th class="px-3 py-3 font-normal text-textLight dark:text-textDark text-left whitespace-nowrap">
              Payment
            </th>
            <th class="px-3 py-3 font-normal text-textLight dark:text-textDark text-center">
              Payment Status
            </th>
            <th class="px-3 py-3 font-normal text-textLight dark:text-textDark text-center">
              Amount
            </th>
            <th class="px-3 py-3 font-normal text-textLight dark:text-textDark text-center">
              Order Status
            </th>
            <th class="px-3 py-3 font-normal text-textLight dark:text-textDark text-center">
              PRE-INVOICE
            </th>
            <th *ngIf="shouldShowPostInvoiceColumn()"
              class="whitespace-nowrap px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
              POST-INVOICE
            </th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngIf="orders && orders.length > 0; else noData">
            <tr *ngFor="let order of orders" class="border-b border-gray-200 dark:border-[#4B555A]">
              <td class="px-3 py-3 text-left dark:text-textDark">{{ order.invNo }}</td>
              <td class="px-3 py-3 text-center dark:text-textDark whitespace-nowrap">
                {{ order.sheduleDate | date : "d MMM, y h:mm a" }}
              </td>
              <td class="px-3 py-3 text-left dark:text-textDark whitespace-nowrap">{{ order.sheduleType }}</td>
              <td class="px-3 py-3 text-left dark:text-textDark whitespace-nowrap">{{ order.paymentMethod === 'Card' ? 'Debit/Credit' : 'Cash on Delivery' }}</td>
              <td class="px-3 py-3 text-center">
                <span [ngClass]="getPaymentStatusClass(order.paymentMethod, order.isPaid)">
                  {{ getPaymentStatusText(order.paymentMethod, order.isPaid) }}
                </span>
              </td>
              <td class="px-3 py-3 text-center dark:text-textDark">
                {{ order.fullTotal | number : "1.2-2" }}
              </td>
              <td class="px-3 py-3 text-center whitespace-nowrap">
                <span *ngIf="activeButton === 'assigned'"
                  class="bg-[#F5FF85] text-[#878216] rounded-xl px-5 py-2">Assigned</span>
                <span *ngIf="activeButton === 'processing'"
                  class="bg-[#CFE1FF] text-[#3B82F6] rounded-xl px-5 py-2">Processing</span>
                <span *ngIf="activeButton === 'Out For Delivery'"
                  class="bg-[#FCD4FF] text-[#80118A] rounded-xl px-5 py-2">Out For Delivery</span>
                <span *ngIf="activeButton === 'Ready to Pickup'"
                  class="bg-[#ACFBFF] text-[#00818A] rounded-xl px-5 py-2">Ready to Pickup</span>
                <span *ngIf="activeButton === 'Picked up'"
                  class="bg-[#BBFFC6] text-[#308233] rounded-xl px-5 py-2">Picked up</span>
                <span *ngIf="activeButton === 'collected'"
                  class="bg-[#F8FEA5] text-[#7E8700] rounded-xl px-5 py-2">Collected</span>
                <span *ngIf="activeButton === 'On the way'" class="bg-[#FFEDCF] text-[#D17A00] rounded-xl px-5 py-2">
                  On the way
                </span>
                <span *ngIf="activeButton === 'delivered'"
                  class="bg-[#BBFFC6] text-[#308233] rounded-xl px-5 py-2">Delivered</span>
                <span *ngIf="activeButton === 'hold'"
                  class="bg-[#FFEDCF] text-[#D17A00] rounded-xl px-5 py-2">Hold</span>
                <span *ngIf="activeButton === 'return'"
                  class="bg-[#FFDCDA] text-[#FF1100] rounded-xl px-5 py-2">Return</span>
                <span *ngIf="activeButton === 'returnReceived'"
                  class="bg-[#FFDCDA] text-[#FF1100] rounded-xl px-5 py-2">Return Received</span>
                <span *ngIf="activeButton === 'cancelled'"
                  class="bg-[#DFDFDF] text-[#5C5C5C] rounded-xl px-5 py-2">Cancelled</span>
              </td>
              <td class="px-3 py-3 text-center dark:text-textDark">
                <button class="text-textLight dark:text-textDark gap-1"
                  (click)="downloadInvoice(order.id, order.invNo)">
                  <i class="fa-solid fa-file-lines text-2xl"></i>
                </button>
              </td>
              <td *ngIf="shouldShowPostInvoiceColumn()" class="px-4 py-3 text-center dark:text-textDark">
                <div class="relative inline-block">
                  <button class="text-textLight dark:text-textDark gap-1 flex items-center justify-center w-full"
                    [class.opacity-50]="!isPostInvoiceEnabled(order.status)"
                    [class.cursor-not-allowed]="!isPostInvoiceEnabled(order.status)"
                    [class.cursor-pointer]="isPostInvoiceEnabled(order.status)"
                    [disabled]="!isPostInvoiceEnabled(order.status)"
                    (click)="isPostInvoiceEnabled(order.status) ? downloadPostInvoice(order.id, order.invNo) : null">
                    <i class="fa-solid fa-file-lines text-2xl"></i>
                  </button>
                </div>
              </td>
            </tr>
          </ng-container>

          <ng-template #noData>
            <tr>
              <td colspan="9" class="px-3 py-16 text-center">
                <div class="flex flex-col items-center justify-center space-y-3">
                  <i class="fa-solid fa-box-open text-5xl text-gray-400 dark:text-gray-500"></i>
                  <p class="text-lg font-medium text-textLight dark:text-textDark">
                    No orders available
                  </p>
                  <p class="text-sm text-gray-500 dark:text-gray-400">
                    There are no orders for the selected status
                  </p>
                </div>
              </td>
            </tr>
          </ng-template>
        </tbody>
      </table>
    </div>
  </div>
</div>