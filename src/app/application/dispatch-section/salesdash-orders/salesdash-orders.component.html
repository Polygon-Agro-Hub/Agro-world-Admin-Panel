<app-loading-spinner *ngIf="isLoading"></app-loading-spinner>

<button class="mb-5 text-textLight dark:text-textDark" (click)="back()">
  <i class="fa-solid fa-arrow-left"></i>
  Back
</button>










<div
  class="fixed-width-container overflow-x-auto scrollbar-thin scrollbar-thumb-[#8AC440] scrollbar-track-transparent scrollbar-thumb-rounded-full">









  <div class="pt-5 pr-12 pl-12 pb-5 min-w-[1200px] bg-white dark:bg-tileBlack shadow-lg rounded-lg">


    <div class="flex space-x-4 pb-5 border-b border-gray-300">
      <button (click)="togglePackageType(true)"
        [ngClass]="isPremade ? 'border border-[#415CFF] text-[#415CFF]' : 'border border-gray-300 text-textLight dark:text-textDark'"
        class="h-10 w-64 flex items-center justify-center rounded-xl gap-2 ">
        <i *ngIf="isPremade" class="fa fa-check"></i>
        Premade Packages
      </button>

      <button (click)="togglePackageType(false)"
        [ngClass]="!isPremade ? 'border border-[#415CFF] text-[#415CFF]' : 'border border-gray-300 text-textLight dark:text-textDark'"
        class="h-10 w-64 flex items-center justify-center rounded-xl gap-2 ">
        <i *ngIf="!isPremade" class="fa fa-check"></i>
        Custom Packages
      </button>
    </div>


    <div class="h-5"></div>


    <div *ngIf="isPremade">

      <div class="flex justify-end items-right mb-8">

        <div class="flex items-center">
          <i class="mr-6 w-6 h-6 fill-current text-gray-500">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path
                d="M0 416c0 17.7 14.3 32 32 32l54.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 448c17.7 0 32-14.3 32-32s-14.3-32-32-32l-246.7 0c-12.3-28.3-40.5-48-73.3-48s-61 19.7-73.3 48L32 384c-17.7 0-32 14.3-32 32zm128 0a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM320 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm32-80c-32.8 0-61 19.7-73.3 48L32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l246.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48l54.7 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-54.7 0c-12.3-28.3-40.5-48-73.3-48zM192 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm73.3-64C253 35.7 224.8 16 192 16s-61 19.7-73.3 48L32 64C14.3 64 0 78.3 0 96s14.3 32 32 32l86.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 128c17.7 0 32-14.3 32-32s-14.3-32-32-32L265.3 64z" />
            </svg>
          </i>




          <div class="mx-6">
            <p-dropdown
              styleClass="border border-2 rounded-xl items-center bg-[#F1F1F1] dark:bg-[#272F45] text-textLight dark:text-textDark border-[#yourLightColor] dark:border-[#AFAFAF] h-10"
              [options]="status" [(ngModel)]="selectedStatus" [showClear]="true" placeholder="Status"
              (onChange)="applyStatus()" />
          </div>

          <div class="flex items-center gap-2">
            <input id="toDate" type="date"
              class="p-2 border rounded-xl bg-[#F1F1F1] dark:bg-[#272F45] text-textLight dark:text-textDark focus:ring focus:ring-blue-300 w-64"
              placeholder="Delivery Date" [(ngModel)]="date" (change)="applyStatus()" />
          </div>








          <div class="w-5"></div>







          <div class="flex items-center rounded-full bg-gray-100 dark:bg-[#272F45] px-4 py-2 w-96">
            <input type="text" placeholder="Search.." class="bg-transparent outline-none w-full text-gray-600"
              [(ngModel)]="search" (keydown.enter)="applysearch()" />
            <button type="button" class="text-gray-500 hover:text-gray-700 focus:outline-none mr-2"
              (click)="applysearch()">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 10-14 0 7 7 0 0014 0z" />
              </svg>
            </button>
            <button (click)="clearSearch()" type="button" class="text-gray-500 hover:text-gray-700 focus:outline-none">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
      </div>


      <div class="flex justify-between items-center mb-5">
        <h4 class="text-2xl font-normal text-[#292929] dark:text-textDark">
          All ({{this.totalItems}})
        </h4>


      </div>



      <div>

        <table class="min-w-full divide-y divide-gray-200 table-auto">
          <thead>
            <tr>
              <th class="py-3 font-normal text-[#4B5563] dark:text-textDark text-left">
                No
              </th>
              <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-start">
                Invoice No
              </th>
              <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-start">
                Package Name
              </th>
              <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                Package Items
              </th>
              <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                Package Price (Rs.)
              </th>
              <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center ">
                Additional Items
              </th>
              <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                Additional Items Price (Rs.)
              </th>
              <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                Scheduled Dilevery Date
              </th>
              <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                Total Price (Rs.)
              </th>
              <th class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                Packaging Status
              </th>


            </tr>
          </thead>
          <tbody>
            <tr *ngFor="
              let item of premadePackages
                | paginate
                  : {
                      itemsPerPage: itemsPerPage,
                      currentPage: page,
                      totalItems: totalItems
                    }
                    let i = index
            ">
              <td class="py-3 text-[#000000] dark:text-textDark text-left">
                {{ ((page - 1) * itemsPerPage + i + 1) | number: '2.0' }}
              </td>

              <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-start">
                {{ item.invNo }}
              </td>
              <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-start">
                {{ item.displayName }}
              </td>
              
              <td class="px-4 py-3 font-normal text-gray-500 dark:text-textDark text-center">

                <button class="w-6 h-6 mr-3" 
                  [class.text-yellow-500]="item.packageProductStatus === 'Opened'"
                  [class.text-green-500]="item.packageProductStatus === 'Completed'"
                  [class.text-red-500]="item.packageProductStatus === 'Pending'"
                  [class.hover:text-yellow-700]="item.packageProductStatus === 'Opened'"
                  [class.hover:text-green-700]="item.packageProductStatus === 'Completed'"
                  [class.hover:text-red-700]="item.packageProductStatus === 'Pending'"
                  >
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M3 14C3 9.02944 7.02944 5 12 5C16.9706 5 21 9.02944 21 14M17 14C17 16.7614 14.7614 19 12 19C9.23858 19 7 16.7614 7 14C7 11.2386 9.23858 9 12 9C14.7614 9 17 11.2386 17 14Z"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </button>

              </td>
              <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                {{ item.productPrice | number: '1.2-2' }}
              <!-- </td>

              <td> -->

              </td>
              <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                <button
                  class="w-6 h-6 mr-3"
                  [disabled]="item.additionalProductsCount === 0"
                  [ngClass]="{
                    'text-gray-300 cursor-not-allowed': item.additionalProductsCount === 0,
                    'text-yellow-500 hover:text-yellow-700': item.additionalProductStatus === 'Opened' && item.additionalProductsCount > 0,
                    'text-green-500 hover:text-green-700': item.additionalProductStatus === 'Completed' && item.additionalProductsCount > 0,
                    'text-red-500 hover:text-red-700': item.additionalProductStatus === 'Pending' && item.additionalProductsCount > 0
                  }"
                  
                >
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M3 14C3 9.02944 7.02944 5 12 5C16.9706 5 21 9.02944 21 14M17 14C17 16.7614 14.7614 19 12 19C9.23858 19 7 16.7614 7 14C7 11.2386 9.23858 9 12 9C14.7614 9 17 11.2386 17 14Z"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
              </td>
              
              <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                <ng-container *ngIf="item.totalAdditionalItemsPrice != 0; else showDash">
                  {{ item.totalAdditionalItemsPrice | number: '1.2-2' }}
                </ng-container>
                <ng-template #showDash>-</ng-template>
              </td>
              <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                {{ item.sheduleDate | date: 'd MMM, y' }}
              </td>
              <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                {{ item.fullTotal | number: '1.2-2' }}
              </td>
              <!-- <td class="px-4 py-3 font-normal text-gray-500 dark:text-textDark text-center">
                {{ item.packingStatus }}
              </td>   -->
              <!-- <td class="px-4 py-3 text-green-500 text-center">
                <div *ngIf="item.packingStatus == 'Todo'">
                  <span
                    class="w-24 h-7 inline-block bg-[#BBFFC6] text-[#308233] font-medium rounded-md px-3 py-1 text-sm">
                    {{ item.packingStatus }}
                  </span>
                </div>
                <div *ngIf="item.packingStatus == 'Pending'">
                  <span
                    class="w-24 h-7 inline-block bg-[#FFB9B7] text-[#D16D6A] font-medium rounded-md px-3 py-1 text-sm">
                    {{ item.packingStatus }}
                  </span>
                </div>
                <div *ngIf="item.packingStatus == 'Opened'">
                  <span
                    class="w-24 h-7 inline-block bg-[#F8FFA6] text-[#A8A100] font-medium rounded-md px-3 py-1 text-sm">
                    {{ item.packingStatus }}
                  </span>
                </div>
              </td> -->

              <td class="px-4 py-3 text-center">
                <ng-container *ngIf="item.combinedStatus === 'Pending'">
                  <span class="w-24 h-7 inline-block bg-[#FFB9B7] text-[#D16D6A] font-medium rounded-md px-3 py-1 text-sm">
                    Pending
                  </span>
                </ng-container>
                
                <ng-container *ngIf="item.combinedStatus === 'Opened'">
                  <span class="w-24 h-7 inline-block bg-[#F8FFA6] text-[#A8A100] font-medium rounded-md px-3 py-1 text-sm">
                    Opened
                  </span>
                </ng-container>
                
                <ng-container *ngIf="item.combinedStatus === 'Completed'">
                  <span class="w-24 h-7 inline-block bg-[#BBFFC6] text-[#308233] font-medium rounded-md px-3 py-1 text-sm">
                    Completed
                  </span>
                </ng-container>
              </td>



            </tr>
          </tbody>
        </table>
        <!-- <div *ngIf="purchaseReport.length === 0" class="text-center py-4 text-gray-500 dark:text-textDark">
        <p class="text-textLight dark:text-textDark text-lg">No data to display</p>
      </div> -->
        <div class="dark:bg-[#262f45]">
          <pagination-controls (pageChange)="onPageChange($event)" [responsive]="true" [previousLabel]="'Previous'"
            [nextLabel]="'Next'" [screenReaderPaginationLabel]="'Pagination'" [screenReaderPageLabel]="'page'"
            [screenReaderCurrentLabel]="'Youre on page'">
          </pagination-controls>
        </div>
      </div>



    </div>




    <div *ngIf="!isPremade">

      <div class="flex justify-end items-right mb-8">

        <div class="flex items-center">
          <i class="mr-6 w-6 h-6 fill-current text-gray-500">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path
                d="M0 416c0 17.7 14.3 32 32 32l54.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 448c17.7 0 32-14.3 32-32s-14.3-32-32-32l-246.7 0c-12.3-28.3-40.5-48-73.3-48s-61 19.7-73.3 48L32 384c-17.7 0-32 14.3-32 32zm128 0a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM320 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm32-80c-32.8 0-61 19.7-73.3 48L32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l246.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48l54.7 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-54.7 0c-12.3-28.3-40.5-48-73.3-48zM192 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm73.3-64C253 35.7 224.8 16 192 16s-61 19.7-73.3 48L32 64C14.3 64 0 78.3 0 96s14.3 32 32 32l86.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 128c17.7 0 32-14.3 32-32s-14.3-32-32-32L265.3 64z" />
            </svg>
          </i>




          <div class="mx-6">
            <p-dropdown
              styleClass="border border-2 rounded-xl items-center bg-[#F1F1F1] dark:bg-[#272F45] text-textLight dark:text-textDark border-[#yourLightColor] dark:border-[#AFAFAF] h-10"
              [options]="statussl" [(ngModel)]="selectedStatussl" [showClear]="true" placeholder="Status"
              (onChange)="applyStatussl()" />
          </div>

          <div class="flex items-center gap-2">
            <input id="toDate" type="date"
              class="p-2 border rounded-xl bg-[#F1F1F1] dark:bg-[#272F45] text-textLight dark:text-textDark focus:ring focus:ring-blue-300 w-64"
              placeholder="Delivery Date" [(ngModel)]="datesl" (change)="applyStatussl()" />
          </div>








          <div class="w-5"></div>







          <div class="flex items-center rounded-full bg-gray-100 dark:bg-[#272F45] px-4 py-2 w-96">
            <input type="text" placeholder="Search..." class="bg-transparent outline-none w-full text-gray-600"
              [(ngModel)]="searchsl" (keydown.enter)="applysearchsl()" />
            <button type="button" class="text-gray-500 hover:text-gray-700 focus:outline-none mr-2"
              (click)="applysearchsl()">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 10-14 0 7 7 0 0014 0z" />
              </svg>
            </button>
            <button (click)="clearSearchsl()" type="button"
              class="text-gray-500 hover:text-gray-700 focus:outline-none">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
      </div>


      <div class="flex justify-between items-center mb-5">
        <h4 class="text-2xl font-normal text-gray-500 dark:text-textDark">
          All ({{this.totalItemssl}})
        </h4>


      </div>



      <div>

        <table class="min-w-full divide-y divide-gray-200 table-auto">
          <thead>
            <tr>
              <th class="py-3 font-normal text-[#000000] dark:text-textDark text-left">
                No
              </th>
              <th class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-start">
                Invoice No
              </th>
              <th class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                Custom Items
              </th>
              <th class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                Scheduled Delivery Date
              </th>
              <th class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                Total Price (Rs.)
              </th>

              <th class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center">
                Package Status
              </th>


            </tr>
          </thead>
          <tbody>
            <tr *ngFor="
                let item of selectdPackage
                  | paginate
                    : {
                        itemsPerPage: itemsPerPagesl,
                        currentPage: pagesl,
                        totalItems: totalItemssl
                      }
                      let i = index
              ">
              <td class="py-3 text-[#000000]] dark:text-textDark text-left">
                {{ (pagesl - 1) * itemsPerPagesl + i + 1 }}
              </td>

              <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-start">
                {{ item.invNo }}
              </td>
              <td class="px-4 py-3 font-normal text-[#000000] dark:text-textDark text-center"
              >
                <button 
                
                class="w-6 h-6 mr-3" [class.text-[#EBC351]]="item.customItemStatus === 'Opened'"
                [disabled]="item.productCount === 0"
                [ngClass]="{
                  'text-gray-300 cursor-not-allowed': item.productCount === 0,
                  'text-yellow-500 hover:text-yellow-700': item.customItemStatus === 'Opened' && item.productCount > 0,
                  'text-green-500 hover:text-green-700': item.customItemStatus === 'Completed' && item.productCount > 0,
                  'text-red-500 hover:text-red-700': item.customItemStatus === 'Pending' && item.productCount > 0
                }"
                  >
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M3 14C3 9.02944 7.02944 5 12 5C16.9706 5 21 9.02944 21 14M17 14C17 16.7614 14.7614 19 12 19C9.23858 19 7 16.7614 7 14C7 11.2386 9.23858 9 12 9C14.7614 9 17 11.2386 17 14Z"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </button>

              </td>
              <td class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                {{ item.sheduleDate | date: 'd MMM, y'}}

              </td>
              <td class="px-4 py-3 font-normal text-[#4B5563] dark:text-textDark text-center">
                {{ item.fullTotal | number: '1.2-2'}}
              </td>
              <td class="px-4 py-3 font-normal text-gray-500 dark:text-textDark text-center">
                <div *ngIf="item.packingStatus == 'Completed'">
                  <span
                    class="w-24 h-7 inline-block bg-green-100 text-green-500 font-medium rounded-md px-3 py-1 text-sm">
                    {{ item.packingStatus }}
                  </span>
                </div>
                <div *ngIf="item.packingStatus == 'Pending'">
                  <span class="w-24 h-7 inline-block bg-red-100 text-red-500 font-medium rounded-md px-3 py-1 text-sm">
                    {{ item.packingStatus }}
                  </span>
                </div>
                <div *ngIf="item.packingStatus == 'Opened'">
                  <span
                    class="w-24 h-7 inline-block bg-yellow-100 text-yellow-500 font-medium rounded-md px-3 py-1 text-sm">
                    {{ item.packingStatus }}
                  </span>
                </div>


              </td>






            </tr>
          </tbody>
        </table>
        <!-- <div *ngIf="purchaseReport.length === 0" class="text-center py-4 text-gray-500 dark:text-textDark">
          <p class="text-textLight dark:text-textDark text-lg">No data to display</p>
        </div> -->
        <div class="dark:bg-[#262f45]">
          <pagination-controls (pageChange)="onPageChangesl($event)" [responsive]="true" [previousLabel]="'Previous'"
            [nextLabel]="'Next'" [screenReaderPaginationLabel]="'Pagination'" [screenReaderPageLabel]="'page'"
            [screenReaderCurrentLabel]="'Youre on page'">
          </pagination-controls>
        </div>
      </div>


    </div>










  </div>
</div>


<div *ngIf="isViewPackageItemsPopupOpen"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="max-w-2xl w-full mx-4 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-y-auto max-h-[120vh]">

    <div class="flex items-center justify-between mb-6 mx-5">
      <div class="">
        <h1 class="font-semibold text-[#627189] dark:text-white">INV No : <span class="text-[#212121]">
            {{orderInv}}</span></h1>
      </div>

      <div class="">
        <h2 class="  text-[#212121] dark:text-white">{{orderName}} : Rs.{{orderPrice}}</h2>
      </div>
    </div>

    <!-- Items Table -->
    <div class="mb-8 ">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
        <thead class="">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-[#8492A3] dark:text-gray-300 uppercase">ITEM
              ({{totalPackageItems}})</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-[#8492A3] dark:text-gray-300 uppercase">QUANTITY
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-[#8492A3] dark:text-gray-300 uppercase">UNIT</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-[#8492A3] dark:text-gray-300 uppercase">UNIT PRICE
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-[#8492A3] dark:text-gray-300 uppercase">TOTAL</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-[#8492A3] dark:text-gray-300 uppercase">PACKED</th>
          </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800 ">
          <!-- Example Row -->
          <tr *ngFor=" let item of packageItemsArr">
            <td class="px-6 py-4 whitespace-nowrap text-sm text-[#212121] dark:text-white">
              {{ item.displayName || 'N/A' }}
            </td>

            <td class="px-6 text-center py-4 whitespace-nowrap text-sm text-[#212121] dark:text-gray-300">
              {{ item.quantity != null ? item.quantity : '0' }}
            </td>

            <td class="px-6 text-center py-4 whitespace-nowrap text-sm text-[#808080] dark:text-gray-300">
              {{ (item.quantity != null && item.quantity < 1) ? 'g' : 'kg' }} </td>

            <td class="px-6 text-center py-4 whitespace-nowrap text-sm text-[#212121] dark:text-gray-300">
              Rs. {{ item.discountedPrice != null ? item.discountedPrice : '0.00' }}
            </td>

            <td class="px-6 py-4 whitespace-nowrap text-sm text-[#212121] dark:text-gray-300">
              Rs. {{ item.total != null ? item.total : '0.00' }}
            </td>

            <td class="px-6 text-center py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
              <input type="checkbox" [checked]="item.isPacking" (change)="onCheckboxChange(item)"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="border-t border-gray-200 dark:border-gray-600 my-6"></div>

    <div class="flex justify-end space-x-4 mx-5">
      <button (click)="isViewPackageItemsPopupOpen = false"
        class="px-4 py-2 border border-gray-300 dark:border-[#74788D] rounded-md text-sm font-medium text-[#D3D3D3] bg-[#74788D] dark:text-white hover:bg-[#74788D] dark:hover:bg-[#74788D]">
        Cancel
      </button>
      <button (click)="saveCheckedItems()"
        class="px-4 py-2 bg-[#3980C0] border border-transparent rounded-md text-sm font-medium text-[#FFFFFF] hover:bg-[#3980C0]">
        Save
      </button>
    </div>
  </div>
</div>




















<div *ngIf="showPopup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <!-- Modal Box -->
  <div class="bg-white dark:bg-tileBlack rounded-lg shadow-lg w-[900px] max-h-[90vh] overflow-auto">
    <!-- Header -->
    <div class="flex justify-between items-center p-5 border-b border-gray-200">
      <div class="font-bold text-lg dark:text-white">
        INV No : {{ selectedInvoice }}
      </div>
      <div class="text-md font-semibold text-gray-700 dark:text-gray-300">
        Custom Pack : Rs.{{ totalPrice }}
      </div>
    </div>

    <!-- Table -->
    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-300">
      <thead class="text-xs text-gray-700 bg-gray-100 dark:bg-gray-900 dark:text-gray-200">
        <tr>
          <th class="px-4 py-3">ITEM</th>
          <th class="px-4 py-3">QUANTITY</th>
          <th class="px-4 py-3">UNIT PRICE</th>
          <th class="px-4 py-3">TOTAL</th>
          <th class="px-4 py-3 text-center">PACKED</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of packItems; let i = index" class="border-b border-gray-200 dark:border-gray-700">
          <td class="px-4 py-3">{{ item.item }}</td>
          <td class="px-4 py-3">{{ item.quantity }}</td>
          <td class="px-4 py-3">Rs.{{ item.UnitPrice | number: '1.2-2' }}</td>
          <td class="px-4 py-3">Rs.{{ item.subtotal | number: '1.2-2' }}</td>
          <td class="text-center py-3">
            <input type="checkbox" [checked]="item.isPacked == 1" (change)="onCheckboxChangeCh($event, i)"
              class="w-5 h-5 rounded border-blue-500 text-blue-500 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed" />
          </td>

        </tr>
      </tbody>
    </table>

    <!-- Footer -->
    <div class="flex justify-end p-4 border-t border-gray-200 gap-2">
      <button (click)="closePopup()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
        Cancel
      </button>
      <button *ngIf="!isUpdating" (click)="savePackedItems()"
        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Save
      </button>
      <button *ngIf="isUpdating" class="px-8 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        <i class="fa-solid fa-spinner fa-spin"></i>
      </button>
    </div>
  </div>
</div>




<div *ngIf="showPopupAdditional" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <!-- Modal Box -->
  <div class="bg-white dark:bg-tileBlack rounded-lg shadow-lg w-[900px] max-h-[90vh] overflow-auto">
    <!-- Header -->
    <div class="flex justify-between items-center p-5 border-b border-gray-200">
      <div class="font-bold text-lg dark:text-white">
        INV No : {{ selectedInvoiceAdditional }}
      </div>
      <div class="text-md font-semibold text-gray-700 dark:text-gray-300">
        Additional Items : Rs.{{ totalPriceAdditional }}
      </div>
    </div>

    <!-- Table -->
    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-300">
      <thead class="text-xs text-gray-700 bg-gray-100 dark:bg-gray-900 dark:text-gray-200">
        <tr>
          <th class="px-4 py-3">ITEM</th>
          <th class="px-4 py-3">QUANTITY</th>
          <th class="px-4 py-3">UNIT PRICE</th>
          <th class="px-4 py-3">TOTAL</th>
          <th class="px-4 py-3 text-center">PACKED</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of packItemsAdditional; let i = index"
          class="border-b border-gray-200 dark:border-gray-700">
          <td class="px-4 py-3">{{ item.item }}</td>
          <td class="px-4 py-3">{{ item.quantity }}</td>
          <td class="px-4 py-3">Rs.{{ item.UnitPrice | number: '1.2-2' }}</td>
          <td class="px-4 py-3">Rs.{{ item.subtotal | number: '1.2-2' }}</td>
          <td class="text-center py-3">
            <input type="checkbox" [checked]="item.isPacked == 1" (change)="onCheckboxChangeChAdditional($event, item)"
              class="w-5 h-5 rounded border-blue-500 text-blue-500 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed" />

          </td>

        </tr>
      </tbody>
    </table>

    <!-- Footer -->
    <div class="flex justify-end p-4 border-t border-gray-200 gap-2">
      <button (click)="closePopupAdditional()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
        Cancel
      </button>
      <button *ngIf="!isUpdating" (click)="savePackedItemsAdditional()"
        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Save
      </button>
      <button *ngIf="isUpdating" class="px-8 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        <i class="fa-solid fa-spinner fa-spin"></i>
      </button>
    </div>
  </div>
</div>