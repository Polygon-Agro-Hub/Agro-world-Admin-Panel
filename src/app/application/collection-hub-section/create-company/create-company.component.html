<app-loading-spinner *ngIf="isLoading"></app-loading-spinner>
<button onclick="history.back()" class="ml-5 text-textLight dark:text-textDark">
  <i class="fa-solid fa-arrow-left"></i>
  Back
</button>
<div class="h-[20px]"></div>

<div class="mx-auto p-6 bg-white dark:bg-tileBlack rounded-lg shadow-mg">
  <div *ngIf="itemId === null">
    <div *ngIf="selectedPage === 'pageOne'">
      <h2 class="text-2xl mb-6 text-textLight dark:text-textDark">
        Add Company Details
      </h2>

      <!-- Logo and Favicon Upload Section -->
      <div class="flex justify-between items-center mb-8">
        <div class="flex items-center">
          <label class="block text-sm font-medium text-gray-700 dark:text-textDark mb-2">
            Add Logo <span class="text-red-600">*</span>
          </label>
          <div class="relative ml-5">
            <input type="file" id="logoUpload" name="logoUpload" accept="image/*" (change)="onLogoChange($event)"
              class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
            <div
              class="w-20 h-20 border-2 border-[#3980C0] dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-tileBlack hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors cursor-pointer">
              <div *ngIf="!companyData.logo" class="text-center">
                <svg class="w-8 h-8 text-gray-400 dark:text-gray-500 mx-auto mb-1" fill="none" stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6">
                  </path>
                </svg>
              </div>
              <img *ngIf="companyData.logo" [src]="companyData.logo" alt="Logo preview"
                class="w-full h-full object-cover rounded-lg" />
            </div>
          </div>
          <div class="ml-3">
            <span *ngIf="isFieldInvalid('logo')" class="text-red-600 text-sm block">Logo is required.</span>
            <span class="text-gray-500 text-xs block">Upload an image less than 1MB</span>
          </div>
        </div>

        <!-- Update the Favicon Upload Section -->
        <div class="flex items-center">
          <label class="block text-sm font-medium text-gray-700 dark:text-textDark mb-2">
            Add Favicon <span class="text-red-600">*</span>
          </label>
          <div class="relative ml-5">
            <input type="file" id="faviconUpload" name="faviconUpload" accept="image/*,.ico"
              (change)="onFaviconChange($event)" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
            <div
              class="w-20 h-20 border-2 border-[#3980C0] dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-tileBlack hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors cursor-pointer">
              <div *ngIf="!companyData.favicon" class="text-center">
                <svg class="w-8 h-8 text-gray-400 dark:text-gray-500 mx-auto mb-1" fill="none" stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6">
                  </path>
                </svg>
              </div>
              <img *ngIf="companyData.favicon" [src]="companyData.favicon" alt="Favicon preview"
                class="w-full h-full object-cover rounded-lg" />
            </div>
          </div>
          <div class="ml-3">
            <span *ngIf="isFieldInvalid('favicon')" class="text-red-600 text-sm block">Favicon is required.</span>
            <span class="text-gray-500 text-xs block">Upload an image less than 1MB</span>
          </div>
        </div>
      </div>

      <hr class="my-5" />

      <div>
        <div class="pb-6">
          <label for="regNumber" class="block text-sm font-medium text-gray-700 dark:text-textDark">Registration Number
            of the Company <span class="text-red-600">*</span></label>
          <input id="regNumber" name="regNumber" [(ngModel)]="companyData.regNumber" (blur)="onBlur('regNumber')"
            (keydown)="handleInputWithSpaceTrimming($event, 'regNumber')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <span *ngIf="isFieldInvalid('regNumber')" class="text-red-600 text-sm">Register Number is required.</span>
        </div>

        <div class="pb-6">
          <label for="companyNameEnglish" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company
            Name (in English) <span class="text-red-600">*</span></label>
          <input id="companyNameEnglish" name="companyNameEnglish" [(ngModel)]="companyData.companyNameEnglish"
            (keydown)="handleInputWithSpaceTrimming($event, 'companyNameEnglish')"
            (input)="capitalizeFirstLetter('companyNameEnglish')" (blur)="onBlur('companyNameEnglish')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <div *ngIf="englishInputError" class="text-red-600 text-sm mt-1">
            Only English letters are allowed.
          </div>
          <span *ngIf="isFieldInvalid('companyNameEnglish')" class="text-red-600 text-sm">Company Name in English
            required.</span>
        </div>

        <div class="pb-6">
          <label for="companyNameSinhala" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company
            Name (in Sinhala) <span class="text-red-600">*</span></label>
          <input id="companyNameSinhala" name="companyNameSinhala" [(ngModel)]="companyData.companyNameSinhala"
            (keydown)="handleInputWithSpaceTrimming($event, 'companyNameSinhala')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <div *ngIf="sinhalaInputError" class="text-red-600 text-sm mt-1">
            Only Sinhala letters are allowed.
          </div>
          <span *ngIf="isFieldInvalid('companyNameSinhala')" class="text-red-600 text-sm">Company Name in Sinhala
            required.</span>
        </div>

        <div class="pb-6">
          <label for="companyNameTamil" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company Name
            (in Tamil) <span class="text-red-600">*</span></label>
          <input id="companyNameTamil" name="companyNameTamil" [(ngModel)]="companyData.companyNameTamil"
            (keydown)="handleInputWithSpaceTrimming($event, 'companyNameTamil')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />

          <div *ngIf="tamilInputError" class="text-red-600 text-sm mt-1">
            Only Tamil letters are allowed.
          </div>
          <span *ngIf="isFieldInvalid('companyNameTamil')" class="text-red-600 text-sm">Company Name in Tamil
            required.</span>
        </div>

        <div class="pb-6">
          <label for="email" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company Email
            Address <span class="text-red-600">*</span></label>
          <input id="email" name="email" [(ngModel)]="companyData.email" (blur)="onBlur('email')" type="email"
            (keydown)="handleInputWithSpaceTrimming($event, 'email')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <span *ngIf="isFieldInvalid('email')" class="text-red-600 text-sm">Email is required.</span>
          <span *ngIf="companyData.email && !isValidEmail(companyData.email)" class="text-red-600 text-sm">
            Enter a valid email address.
          </span>
        </div>
      </div>

      <div class="flex justify-end m-10">
        <button type="submit" class="px-4 py-2 w-20 bg-[#74788D] text-white rounded-md mr-5" onclick="history.back()">
          Cancel
        </button>
        <button type="submit" class="px-4 py-2 bg-[#3980C0] text-white rounded-md" (click)="nextFormCreate('pageTwo')">
          Next
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="itemId === null">
    <div *ngIf="selectedPage === 'pageTwo'">
      <h2 class="text-2xl mb-6 text-textLight dark:text-textDark">
        Billing Information
      </h2>
      <div>
        <div class="pb-6">
          <label for="accHolderName" class="block text-sm font-medium text-gray-700 dark:text-textDark">Account Holderâ€™s
            Name <span class="text-red-600">*</span></label>
          <input id="companyNameEnglish" name="companyNameEnglish" [(ngModel)]="companyData.accHolderName"
            (keydown)="handleInputWithSpaceTrimming($event, 'accHolderName')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <div *ngIf="invalidCharError" class="text-red-500 text-sm mt-1">
            Only English letters, spaces, apostrophes (') and hyphens (-) are allowed.
          </div>
          <span *ngIf="isFieldInvalid('accHolderName')" class="text-red-600 text-sm">Account Holder Name is
            required.</span>
        </div>

        <div class="pb-6">
          <label for="accNumber" class="block text-sm font-medium text-gray-700 dark:text-textDark">
            Account Number <span class="text-red-600">*</span>
          </label>
          <input id="accNumber" name="accNumber" [(ngModel)]="companyData.accNumber" (blur)="onBlur('accNumber')"
            (keypress)="numberOnly($event)" (paste)="onPaste($event, 'accNumber')"
            (keydown)="handleInputWithSpaceTrimming($event, 'accNumber')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <span *ngIf="isFieldInvalid('accNumber')" class="text-red-600 text-sm">
            Account Number is required.
          </span>
        </div>

        <div class="pb-6">
          <label for="confirmAccNumber" class="block text-sm font-medium text-gray-700 dark:text-textDark">
            Confirm Account Number <span class="text-red-600">*</span>
          </label>
          <input id="confirmAccNumber" name="confirmAccNumber" [(ngModel)]="companyData.confirmAccNumber"
            (blur)="onBlur('confirmAccNumber')" (keypress)="numberOnly($event)"
            (keydown)="handleInputWithSpaceTrimming($event, 'confirmAccNumber')"
            (paste)="onPaste($event, 'confirmAccNumber')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />

          <!-- Required validation message -->
          <span *ngIf="confirmAccountNumberRequired" class="text-red-600 text-sm">
            Confirm Account Number is required.
          </span>

          <!-- Mismatch validation message -->
          <span *ngIf="confirmAccountNumberError && !confirmAccountNumberRequired" class="text-red-600 text-sm">
            Account Numbers do not match.
          </span>
        </div>

        <div class="pb-6">
          <label for="bankDropdown" class="block text-sm font-medium text-gray-700 dark:text-textDark">
            Bank Name <span class="text-red-600">*</span>
          </label>
          <select id="bankDropdown" name="bankDropdown" [(ngModel)]="selectedBankId" (change)="onBankChange()"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack">
            <option [ngValue]="null" disabled>Select a bank <span class="text-red-600">*</span></option>
            <option *ngFor="let bank of banks" [ngValue]="bank.ID">
              {{ bank.name }}
            </option>
          </select>
          <span *ngIf="isFieldInvalid('bankName')" class="text-red-600 text-sm">
            Bank Name is required.
          </span>
        </div>

        <div class="pb-6">
          <label for="branchDropdown" class="block text-sm font-medium text-gray-700 dark:text-textDark">
            Branch Name <span class="text-red-600">*</span>
          </label>
          <select id="branchDropdown" name="branchDropdown" [(ngModel)]="selectedBranchId" (change)="onBranchChange()"
            [disabled]="!selectedBankId"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack">
            <option [ngValue]="null" disabled>Select a branch</option>
            <option *ngFor="let branch of branches" [ngValue]="branch.ID">
              {{ branch.name }}
            </option>
          </select>
          <span *ngIf="isFieldInvalid('branchName')" class="text-red-600 text-sm">
            Branch Name is required.
          </span>
        </div>

        <div class="pb-6">
          <label for="companyEmail" class="block text-sm font-medium text-gray-700 dark:text-textDark">Finance Officerâ€™s
            Name <span class="text-red-600">*</span></label>
          <input id="foName" name="foName" [(ngModel)]="companyData.foName" (keydown)="allowOnlyEnglishLetterss($event)"
            (keydown)="handleInputWithSpaceTrimming($event, 'foName')" (input)="capitalizeFirstLetter('foName')"
            (blur)="onBlur('foName')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />

          <!-- Error message -->
          <div *ngIf="invalidFoName" class="text-red-500 text-sm mt-1">
            Only English letters and spaces are allowed in Finance Officerâ€™s Name.
          </div>

          <span *ngIf="isFieldInvalid('foName')" class="text-red-600 text-sm">Finance Officerâ€™s Name is required.</span>
        </div>

        <div class="flex gap-5">
          <div class="w-1/2">
            <label for="phoneNumber01" class="block text-sm font-medium text-gray-700 dark:text-textDark">
              Company Contact Number - 1 <span class="text-red-600">*</span>
            </label>
            <div class="mt-1 flex">
              <select id="phoneNumber01Code" name="oicConCode1" [(ngModel)]="companyData.oicConCode1"
                class="block p-2 border border-gray-300 rounded-l-md bg-gray-50 mr-5 text-textLight dark:text-textDark dark:bg-tileBlack">
                <option value="+94">
                  ðŸ‡±ðŸ‡° +94
                </option>
                <option value="+84">
                  ðŸ‡»ðŸ‡³ +84
                </option>
                <option value="+855">
                  ðŸ‡°ðŸ‡­ +855
                </option>
                <option value="+880">
                  ðŸ‡§ðŸ‡© +880
                </option>
                <option value="+91">
                  ðŸ‡®ðŸ‡³ +91
                </option>
                <option value="+31">
                  ðŸ‡³ðŸ‡± +31
                </option>
              </select>
              <div class="w-full flex flex-col">
                <input id="phoneNumber01" name="oicConNum1" type="text" inputmode="numeric" pattern="[0-9]*"
                  maxlength="9" required
                  class="block w-full p-2 border border-gray-300 rounded-r-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
                  placeholder="7XXXXXXXX" [(ngModel)]="companyData.oicConNum1" #oicConNum1Ref="ngModel"
                  (keydown)="handleInputWithSpaceTrimming($event, 'oicConNum1')" (blur)="validateContactNumbers()" />
                <div *ngIf="oicConNum1Ref.invalid && oicConNum1Ref.touched && oicConNum1Ref.errors?.['required']"
                  class="text-red-500 text-sm mt-1">
                  Company Contact Number - 1 is required.
                </div>
                <div *ngIf="contactNumberError1 && oicConNum1Ref.valid" class="text-red-500 text-sm mt-1">
                  Contact number must be exactly 9 digits.
                </div>
              </div>
            </div>
          </div>

          <div class="w-1/2">
            <label for="phoNumTwo" class="block text-sm font-medium text-gray-700 dark:text-textDark">
              Company Contact Number - 2
            </label>
            <div class="mt-1 flex">
              <select id="phoneNumber02Code" name="oicConCode2" [(ngModel)]="companyData.oicConCode2"
                (blur)="validateContactNumbers()"
                class="block p-2 border border-gray-300 rounded-l-md bg-gray-50 mr-5 text-textLight dark:text-textDark dark:bg-tileBlack">
                <option value="+94">
                  ðŸ‡±ðŸ‡° +94
                </option>
                <option value="+84">
                  ðŸ‡»ðŸ‡³ +84
                </option>
                <option value="+855">
                  ðŸ‡°ðŸ‡­ +855
                </option>
                <option value="+880">
                  ðŸ‡§ðŸ‡© +880
                </option>
                <option value="+91">
                  ðŸ‡®ðŸ‡³ +91
                </option>
                <option value="+31">
                  ðŸ‡³ðŸ‡± +31
                </option>
              </select>
              <input id="phoneNumber02" name="oicConNum2" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="9"
                (keydown)="handleInputWithSpaceTrimming($event, 'oicConNum2')"
                class="block w-full p-2 border border-gray-300 rounded-r-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack"
                placeholder="7XXXXXXXX" [(ngModel)]="companyData.oicConNum2" (blur)="validateContactNumbers()" />
              <div *ngIf="contactNumberError2" class="text-red-500 text-sm mt-1">
                Contact number must be exactly 9 digits.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-end m-10">
        <button (click)="nextFormCreate('pageOne')" type="button"
          class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md mr-2">
          Back
        </button>
        <button type="button" (click)="saveCompanyData()" [disabled]="
            !companyData.confirmAccNumber ||
            !companyData.accNumber ||
            !companyData.accHolderName ||
            !companyData.bankName ||
            !companyData.branchName ||
            !companyData.foName ||
            companyData.accNumber != companyData.confirmAccNumber
          " class="px-4 py-2 bg-[#3980C0] text-white rounded-md">
          Submit
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="itemId !== null && !isView">
    <div *ngIf="selectedPage === 'pageOne'">
      <h2 class="text-2xl mb-6 text-textLight dark:text-textDark">
        Edit Company Details
      </h2>

      <div class="flex justify-between items-center mb-8">
        <!-- Logo Section -->
        <div class="flex items-center">
          <label class="block text-sm font-medium text-gray-700 dark:text-textDark mb-2">
            Add Logo
          </label>
          <div class="relative ml-5">
            <!-- Changed structure to make the label the clickable area -->
            <label for="logoUpload" class="cursor-pointer">
              <div
                class="w-20 h-20 border-2 border-[#3980C0] dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-tileBlack hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors relative">
                <div *ngIf="!companyData.logo" class="text-center">
                  <svg class="w-8 h-8 text-gray-400 dark:text-gray-500 mx-auto mb-1" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                </div>
                <img *ngIf="companyData.logo" [src]="companyData.logo" alt="Logo preview"
                  class="w-full h-full object-cover rounded-lg" />
                <!-- Remove button for logo -->
                <button *ngIf="companyData.logo" (click)="removeLogo($event)" type="button"
                  class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs hover:bg-red-600 transition-colors">
                  Ã—
                </button>
              </div>
            </label>
            <input type="file" id="logoUpload" name="logoUpload" accept="image/*" (change)="onLogoChange($event)"
              class="hidden" />
          </div>
          <span *ngIf="isFieldInvalid('logo')" class="text-red-600 text-sm mt-1">
            Logo is required.
          </span>
        </div>

        <!-- Favicon Section -->
        <div class="flex items-center">
          <label class="block text-sm font-medium text-gray-700 dark:text-textDark mb-2">
            Add Favicon
          </label>
          <div class="relative ml-5">
            <!-- Changed structure to make the label the clickable area -->
            <label for="faviconUpload" class="cursor-pointer">
              <div
                class="w-20 h-20 border-2 border-[#3980C0] dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-tileBlack hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors relative">
                <div *ngIf="!companyData.favicon" class="text-center">
                  <svg class="w-8 h-8 text-gray-400 dark:text-gray-500 mx-auto mb-1" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                </div>
                <img *ngIf="companyData.favicon" [src]="companyData.favicon" alt="Favicon preview"
                  class="w-full h-full object-cover rounded-lg" />
                <!-- Remove button for favicon -->
                <button *ngIf="companyData.favicon" (click)="removeFavicon($event)" type="button"
                  class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs hover:bg-red-600 transition-colors">
                  Ã—
                </button>
              </div>
            </label>
            <input type="file" id="faviconUpload" name="faviconUpload" accept="image/*,.ico"
              (change)="onFaviconChange($event)" class="hidden" />
          </div>
          <span *ngIf="isFieldInvalid('favicon')" class="text-red-600 text-sm mt-1">
            Favicon is required.
          </span>
        </div>
      </div>

      <hr class="my-5" />

      <div>
        <div class="pb-6">
          <label for="regNumber" class="block text-sm font-medium text-gray-700 dark:text-textDark">Registration Number
            of the Company</label>
          <input [(ngModel)]="companyData.regNumber" id="regNumber" name="regNumber"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <div *ngIf="
              userForm.get('regNumber')!.invalid &&
              (userForm.get('regNumber')!.dirty ||
                userForm.get('regNumber')!.touched)
            " class="text-red-500 text-sm mt-1">
            <div *ngIf="userForm.get('regNumber')!.errors?.['required']">
              Phone number is required.
            </div>
            <div *ngIf="userForm.get('regNumber')!.errors?.['pattern']">
              Please enter a valid phone number starting with +94 followed by 9
              digits.
            </div>
          </div>
        </div>

        <div class="pb-6">
          <label for="companyNameEnglish" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company
            Name (in English)</label>
          <input id="companyNameEnglish" name="companyNameEnglish" [(ngModel)]="companyData.companyNameEnglish"
            (keydown)="allowOnlyEnglishLetters($event)" (input)="capitalizeFirstLetter('companyNameEnglish')"
            (blur)="onBlur('companyNameEnglish')"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <div *ngIf="englishInputError" class="text-red-600 text-sm mt-1">
            Only English letters are allowed.
          </div>


          <div *ngIf="
              userForm.get('companyNameEnglish')!.invalid &&
              (userForm.get('companyNameEnglish')!.dirty ||
                userForm.get('companyNameEnglish')!.touched)
            " class="text-red-500 text-sm mt-1">
            <div *ngIf="userForm.get('companyNameEnglish')!.errors?.['required']">
              Company Name is required.
            </div>
          </div>
        </div>

        <div class="pb-6">
          <label for="companyNameSinhala" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company
            Name (in Sinhala)</label>
          <input id="companyNameSinhala" name="companyNameSinhala" [(ngModel)]="companyData.companyNameSinhala"
            (keydown)="allowOnlySinhalaLetters($event)"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <div *ngIf="sinhalaInputError" class="text-red-600 text-sm mt-1">
            Only Sinhala letters are allowed.
          </div>
          <div *ngIf="
              userForm.get('companyNameSinhala')!.invalid &&
              (userForm.get('companyNameSinhala')!.dirty ||
                userForm.get('companyNameSinhala')!.touched)
            " class="text-red-500 text-sm mt-1">
            <div *ngIf="userForm.get('companyNameSinhala')!.errors?.['required']">
              Company Name is required.
            </div>
          </div>
        </div>

        <div class="pb-6">
          <label for="companyNameTamil" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company Name
            (in Tamil)</label>
          <input id="companyNameTamil" name="companyNameTamil" [(ngModel)]="companyData.companyNameTamil"
            (keydown)="allowOnlyTamilLetters($event)"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />

          <div *ngIf="tamilInputError" class="text-red-600 text-sm mt-1">
            Only Tamil letters are allowed.
          </div>




          <div *ngIf="
              userForm.get('companyNameTamil')!.invalid &&
              (userForm.get('companyNameTamil')!.dirty ||
                userForm.get('companyNameTamil')!.touched)
            " class="text-red-500 text-sm mt-1">
            <div *ngIf="userForm.get('companyNameTamil')!.errors?.['required']">
              Company Name is required.
            </div>
          </div>
        </div>

        <div class="pb-6">
          <label for="email" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company Email
            Address</label>
          <input id="email" name="email" [(ngModel)]="companyData.email" type="email"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <div *ngIf="
              userForm.get('email')!.invalid &&
              (userForm.get('email')!.dirty || userForm.get('email')!.touched)
            " class="text-red-500 text-sm mt-1">
            <div *ngIf="userForm.get('email')!.errors?.['required']">
              Email is required.
            </div>
          </div>
        </div>
        <!-- Contact Number 1 -->
        <div class="pb-6">
          <label for="oicConNum1" class="block text-sm font-medium text-gray-700 dark:text-textDark">
            Company Contact Number - 1
          </label>
          <div class="flex space-x-2">
            <input id="oicConCode1" name="oicConCode1" [(ngModel)]="companyData.oicConCode1" type="text" maxlength="4"
              placeholder="+94"
              class="w-20 p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
            <input id="oicConNum1" name="oicConNum1" [(ngModel)]="companyData.oicConNum1" type="text"
              pattern="^[0-9]{10}$" required #oicConNum1="ngModel"
              class="flex-1 p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          </div>
          <div *ngIf="oicConNum1.invalid && (oicConNum1.dirty || oicConNum1.touched)" class="text-red-500 text-sm mt-1">
            <div *ngIf="oicConNum1.errors?.['required']">Contact Number 1 is required.</div>
            <div *ngIf="oicConNum1.errors?.['pattern']">Please enter a valid 10-digit phone number.</div>
          </div>
        </div>

        <!-- Contact Number 2 (conditionally shown) -->
        <div class="pb-6" *ngIf="companyData.oicConNum2">
          <label for="oicConNum2" class="block text-sm font-medium text-gray-700 dark:text-textDark">
            Company Contact Number - 2
          </label>
          <div class="flex space-x-2">
            <input id="oicConCode2" name="oicConCode2" [(ngModel)]="companyData.oicConCode2" type="text" maxlength="4"
              placeholder="+94"
              class="w-20 p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
            <input id="oicConNum2" name="oicConNum2" [(ngModel)]="companyData.oicConNum2" type="text"
              pattern="^[0-9]{10}$" #oicConNum2="ngModel"
              class="flex-1 p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          </div>
          <div *ngIf="oicConNum2.invalid && (oicConNum2.dirty || oicConNum2.touched)" class="text-red-500 text-sm mt-1">
            <div *ngIf="oicConNum2.errors?.['pattern']">Please enter a valid 10-digit phone number.</div>
          </div>
        </div>





      </div>

      <div class="flex justify-end m-10">
        <button type="button" (click)="onCancel()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md mr-2">
          Cancel
        </button>
        <button type="submit" class="px-4 py-2 bg-[#3980C0] text-white rounded-md" (click)="nextFormCreate('pageTwo')">
          Next
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="itemId !== null && !isView">
    <div *ngIf="selectedPage === 'pageTwo'">
      <h2 class="text-2xl mb-6 text-textLight dark:text-textDark">
        Edit Billing Information
      </h2>
      <div>
        <div class="pb-6">
          <label for="companyNameEnglish" class="block text-sm font-medium text-gray-700 dark:text-textDark">Account
            Holderâ€™s Name</label>

          <input id="companyNameEnglish" name="companyNameEnglish" [(ngModel)]="companyData.accHolderName"
            (keydown)="allowOnlyValidNameCharacters($event)"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <div *ngIf="invalidCharError" class="text-red-500 text-sm mt-1">
            Only English letters, spaces, apostrophes (') and hyphens (-) are allowed.
          </div>
        </div>

        <div class="pb-6">
          <label for="accNumber" class="block text-sm font-medium text-gray-700 dark:text-textDark">
            Account Number
          </label>
          <input type="text" id="accNumber" name="accNumber" [(ngModel)]="companyData.accNumber"
            (keydown)="allowOnlyDigits($event)" (blur)="validateConfirmAccNumber()"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />

          <!-- Show error message -->
          <div *ngIf="accountNumberError" class="text-red-600 text-sm mt-1">
            Only digits are allowed in account number.
          </div>


          <span *ngIf="isFieldInvalid('accNumber')" class="text-red-600 text-sm">
            Account Number is required.
          </span>
        </div>

        <div class="pb-6">
          <label class="block text-sm font-medium text-gray-700 dark:text-textDark">
            Confirm Account Number
          </label>
          <input type="text" id="accNumber" name="accNumber" [(ngModel)]="companyData.accNumber"
            (keydown)="allowOnlyDigits($event)" (blur)="validateConfirmAccNumber()"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
          <!-- Show required error only when field is empty -->
          <span *ngIf="confirmAccountNumberRequired" class="text-red-600 text-sm">
            Confirm Account Number is required.
          </span>

          <!-- Show mismatch error only when numbers don't match and field isn't empty -->
          <span *ngIf="confirmAccountNumberError && !confirmAccountNumberRequired" class="text-red-600 text-sm">
            Account Numbers do not match.
          </span>
        </div>

        <div class="pb-6">
          <label for="bankDropdown" class="block text-sm font-medium text-gray-700 dark:text-textDark">Bank Name</label>
          <select id="bankDropdown" name="bankDropdown" [(ngModel)]="selectedBankId" (change)="onBankChange()"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack">
            <option [ngValue]="null" disabled>Select a bank</option>
            <option *ngFor="let bank of banks" [ngValue]="bank.ID">
              {{ bank.name }}
            </option>
          </select>
        </div>

        <div class="pb-6">
          <label for="branchDropdown" class="block text-sm font-medium text-gray-700 dark:text-textDark">Branch
            Name</label>
          <select id="branchDropdown" name="branchDropdown" [(ngModel)]="selectedBranchId" (change)="onBranchChange()"
            [disabled]="!selectedBankId"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack">
            <option [ngValue]="null" disabled>Select a branch</option>
            <option *ngFor="let branch of branches" [ngValue]="branch.ID">
              {{ branch.name }}
            </option>
          </select>
        </div>
      </div>

      <div class="flex justify-end m-10">
        <button (click)="nextFormCreate('pageOne')" type="button"
          class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md mr-2">
          Back
        </button>
        <button type="button" (click)="updateCompanyData()" [disabled]="
            !companyData.confirmAccNumber ||
            !companyData.accNumber ||
            !companyData.accHolderName ||
            !companyData.bankName ||
            !companyData.branchName ||
            companyData.accNumber != companyData.confirmAccNumber
          " class="px-4 py-2 bg-[#3980C0] text-white rounded-md">
          Save
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="itemId !== null && isView">
    <h2 class="text-2xl mb-6 text-textLight dark:text-textDark">
      Company Details
    </h2>
    <div>
      <div class="pb-6">
        <label for="regNumber" class="block text-sm font-medium text-gray-700 dark:text-textDark">Registration Number of
          the Company</label>
        <input id="regNumber" name="regNumber" [(ngModel)]="companyData.regNumber" [disabled]="true"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
      </div>

      <div class="pb-6">
        <label for="companyNameEnglish" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company Name
          (in English)</label>
        <input id="companyNameEnglish" name="companyNameEnglish" [(ngModel)]="companyData.companyNameEnglish"
          (blur)="onBlur('companyNameEnglish')"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
        <div class="flex items-center mt-1">
          <span *ngIf="isCheckingCompanyName" class="text-blue-600 text-sm">
            Checking company name...
          </span>
          <span *ngIf="companyNameError" class="text-red-600 text-sm">
            {{ companyNameError }}
          </span>
          <span *ngIf="isFieldInvalid('companyNameEnglish') && !companyNameError" class="text-red-600 text-sm">Company
            Name in English required.</span>
        </div>
      </div>

      <div class="pb-6">
        <label for="companyNameSinhala" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company Name
          (in Sinhala)</label>
        <input id="companyNameSinhala" name="companyNameSinhala" [(ngModel)]="companyData.companyNameSinhala"
          [disabled]="true"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
      </div>

      <div class="pb-6">
        <label for="companyNameTamil" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company Name
          (in Tamil)</label>
        <input id="companyNameTamil" name="companyNameTamil" [(ngModel)]="companyData.companyNameTamil"
          [disabled]="true"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
      </div>

      <div class="pb-6">
        <label for="email" class="block text-sm font-medium text-gray-700 dark:text-textDark">Company Email
          Address</label>
        <input id="email" name="email" [(ngModel)]="companyData.email" [disabled]="true" type="email"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
      </div>

      <div class="pb-6">
        <label for="oicConNum1" class="block text-sm font-medium text-gray-700 dark:text-textDark">
          Company Contact Number - 1
        </label>
        <input id="oicConNum1" name="oicConNum1" [value]="companyData.oicConCode1 + ' ' + companyData.oicConNum1"
          [disabled]="true" type="text"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
      </div>

      <div class="pb-6" *ngIf="companyData.oicConNum2">
        <label for="oicConNum2" class="block text-sm font-medium text-gray-700 dark:text-textDark">
          Company Contact Number - 2
        </label>
        <input id="oicConNum2" name="oicConNum2" [value]="companyData.oicConCode2 + ' ' + companyData.oicConNum2"
          [disabled]="true" type="text"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
      </div>


    </div>



    <h2 class="text-2xl mt-5 mb-10 text-textLight dark:text-textDark">
      Billing Information
    </h2>
    <div>
      <div class="pb-6">
        <label for="companyNameEnglish" class="block text-sm font-medium text-gray-700 dark:text-textDark">Account
          Holderâ€™s Name</label>
        <input id="companyNameEnglish" name="companyNameEnglish" [(ngModel)]="companyData.accHolderName"
          (keydown)="allowOnlyValidNameCharacters($event)"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
        <div *ngIf="invalidCharError" class="text-red-500 text-sm mt-1">
          Only English letters, spaces, apostrophes (') and hyphens (-) are allowed.
        </div>
      </div>

      <div class="pb-6">
        <label for="accNumber" class="block text-sm font-medium text-gray-700 dark:text-textDark">
          Account Number
        </label>
        <input id="accNumber" name="accNumber" [(ngModel)]="companyData.accNumber" [disabled]="true"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
      </div>

      <div>
        <div class="pb-6">
          <label for="bankName" class="block text-sm font-medium text-gray-700 dark:text-textDark">Bank Name</label>
          <input id="bankName" name="bankName" [(ngModel)]="companyData.bankName" [disabled]="true"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
        </div>
      </div>

      <div>
        <div class="pb-6">
          <label for="branchName" class="block text-sm font-medium text-gray-700 dark:text-textDark">Branch Name</label>
          <input id="branchName" name="branchName" [(ngModel)]="companyData.branchName" [disabled]="true"
            class="mt-1 block w-full p-2 border border-gray-300 rounded-md text-textLight dark:text-textDark bg-tileLight dark:bg-tileBlack" />
        </div>
      </div>
    </div>
  </div>
</div>