<!-- Back Button -->
<button class="flex items-center gap-2 mb-5 text-textLight dark:text-textDark hover:opacity-80 transition"
  (click)="back()" [disabled]="isUploading">
  <i class="fa-solid fa-arrow-left"></i>
  <span>Back</span>
</button>

<!-- Main Card -->
<div class="bg-white dark:bg-tileBlack rounded-lg shadow-lg p-8">
  <h1 class="text-2xl font-semibold text-textLight dark:text-textDark mb-8">
    Upload Payment File
  </h1>

  <!-- Form -->
  <div class="space-y-6">
    <!-- Receivers and Amount Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Receivers Dropdown -->
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-textDark mb-2">
          Receivers <span class="text-gray-700 dark:text-textDark">*</span>
        </label>
        <div class="relative">
  <!-- PrimeNG Dropdown -->
  <p-dropdown 
    [(ngModel)]="receivers" 
    [options]="receiverOptions"
    optionLabel="label"
    optionValue="value"
    [disabled]="isUploading"
    placeholder="Select Receiver"
    [styleClass]="'w-full'"
    [panelStyleClass]="'bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600'">
  </p-dropdown>
</div>

      </div>

      <!-- Amount Input -->
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-textDark mb-2">
          Total Amount (Rs.) <span class="text-gray-700 dark:text-textDark">*</span>
        </label>
        <input type="number" [(ngModel)]="amount" (blur)="formatAmount($event)" [disabled]="isUploading"
          placeholder="--Enter Total Amount--"
          class="w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-textLight dark:text-textDark placeholder:italic focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed" />
      </div>
    </div>

<div>
  <label class="block text-sm font-medium text-gray-700 dark:text-textDark mb-2">
    Payment Reference <span class="text-gray-700 dark:text-textDark">*</span>
    <span 
      class="text-xs ml-2"
      [ngClass]="{
        'text-red-500': paymentReference.length > MAX_REFERENCE_LENGTH,
        'text-gray-500 dark:text-gray-400': paymentReference.length <= MAX_REFERENCE_LENGTH
      }">
      ({{ paymentReference.length || 0 }}/{{ MAX_REFERENCE_LENGTH }} characters)
    </span>
  </label>
  <input 
    type="text" 
    [(ngModel)]="paymentReference" 
    [disabled]="isUploading"
    [maxlength]="MAX_REFERENCE_LENGTH"
    (input)="onPaymentReferenceInput($event)"
    placeholder="--Enter Payment Reference here--"
    class="w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-textLight dark:text-textDark placeholder:italic focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed" />
</div>

    <!-- CSV File Upload -->
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-textDark mb-2">
        CSV File <span class="text-gray-700 dark:text-textDark">*</span>
      </label>

      <!-- File Input (Hidden) -->
      <input type="file" id="csvFileInput" accept=".csv,.xlsx,.xls" (change)="onFileSelected($event)"
        [disabled]="isUploading" class="hidden" />

      <!-- Drag and Drop Area -->
      <div (click)="triggerFileInput()" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)" [class.border-blue-500]="isDragging" [class.bg-blue-50]="isDragging"
        [class.dark:bg-blue-900]="isDragging" [class.opacity-50]="isUploading" [class.cursor-not-allowed]="isUploading"
        [class.cursor-pointer]="!isUploading"
        class="border-2 border-dashed border-blue-400 dark:border-blue-500 rounded-lg p-12 text-center transition-all hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900 bg-blue-50 dark:bg-gray-800">

        <!-- Upload Icon -->
        <div class="flex justify-center mb-4">
          <div class="w-16 h-16 bg-gray-200 dark:bg-gray-600 rounded-full flex items-center justify-center">
            <i class="fa-solid fa-cloud-arrow-up text-3xl text-gray-400 dark:text-gray-300"></i>
          </div>
        </div>

        <!-- Upload Text -->
        <p class="text-blue-500 dark:text-blue-400 font-medium mb-1">
          {{ isUploading ? 'Uploading...' : 'Select the CSV file to upload' }}
        </p>
        <p class="text-sm text-gray-500 dark:text-gray-400">
          {{ isUploading ? 'Please wait' : 'or drag and drop it here' }}
        </p>
        <p class="text-xs text-gray-400 dark:text-gray-500 mt-2">
          Supported formats: .xlsx, .xls, .csv (Max: 10MB)
        </p>
      </div>

      <!-- Uploaded File Name with Remove Option -->
      <div *ngIf="uploadedFileName"
        class="mt-3 flex items-center justify-between bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3">
        <div class="flex items-center gap-2">
          <div>
            <span class="text-sm font-medium text-gray-700 dark:text-textDark">
              {{ uploadedFileName }}
            </span>
            <p class="text-xs text-gray-500 dark:text-gray-400">
              File ready to upload
            </p>
          </div>
        </div>
        <button (click)="removeFile()" [disabled]="isUploading"
          class="text-red-500 hover:text-red-600 transition disabled:opacity-50 disabled:cursor-not-allowed"
          title="Remove file">
          <i class="fa-solid fa-times text-xl"></i>
        </button>
      </div>
    </div>


    <!-- Action Buttons -->
    <div class="flex justify-end gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
      <button (click)="onCancel()" [disabled]="isUploading"
        class="px-6 py-2.5 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
        <span>Cancel</span>
      </button>
      <button (click)="onUpload()" [disabled]="isUploading || !isFormValid()"
        class="px-6 py-2.5 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
        <span>{{ isUploading ? 'Uploading...' : 'Upload' }}</span>
      </button>
    </div>
  </div>
</div>